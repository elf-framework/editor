(function(s,n){typeof exports=="object"&&typeof module!="undefined"?n(exports,require("@elf-framework/sapa")):typeof define=="function"&&define.amd?define(["exports","@elf-framework/sapa"],n):(s=typeof globalThis!="undefined"?globalThis:s||self,n(s.baseEditor={},s.sapa))})(this,function(s,n){"use strict";var T=Object.defineProperty;var f=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var d=(s,n,o)=>n in s?T(s,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[n]=o,c=(s,n)=>{for(var o in n||(n={}))M.call(n,o)&&d(s,o,n[o]);if(f)for(var o of f(n))U.call(n,o)&&d(s,o,n[o]);return s};var o="";class C{constructor(t){this.editorContext=t,this.localCommands={}}loadCommands(t={}){Object.keys(t).forEach(i=>{n.isFunction(t[i])?this.registerCommand(i,t[i]):this.registerCommand(t[i])})}registerCommand(t,i){if(this.localCommands[t])throw new Error(`command ${t} is already registered`);if(arguments.length===2){const e=(...a)=>i.call(this,this.editorContext,...a);e.source=t,this.localCommands[t]=e}else if(n.isObject(t)){if(!t.command)throw new Error("command is required",t);if(!t.execute)throw new Error("callback is required",t);const e=(...a)=>t.execute.call(t,this.editorContext,...a);e.source=t.command,this.localCommands[t.command]=e}}getCallback(t){return this.localCommands[t]}emit(t,...i){const e=this.getCallback(t);if(e)return e(...i)}}class m{constructor(t){this.editorContext=t,this.configList=[],this.config=new Map}get(t){var i;return this.config.has(t)===!1&&this.config.set(t,(i=this.configList.find(e=>e.key==t))==null?void 0:i.defaultValue),this.config.get(t)}set(t,i){const e=this.config.get(t);e!==i&&(this.config.set(t,i),this.editorContext.emit("config:"+t,i,e))}push(t,i){const a=this.get(t).length;return this.setIndexValue(t,a,i),a}setIndexValue(t,i,e){const a=this.get(t);a[i]=e,this.set(t,[...a])}getIndexValue(t,i){return this.get(t)[i]}removeByIndex(t,i){const e=this.get(t);e.splice(i,1),this.set(t,[...e])}init(t,i){this.set(t,i,!1)}setAll(t){Object.keys(t).forEach(i=>{this.set(i,t[i])})}getType(t){var i;return(i=this.configList.find(e=>e.key==t))==null?void 0:i.type}isType(t,i){return this.getType(t)===i}isBoolean(t){return this.isType(t,"boolean")}toggle(t){this.set(t,!this.get(t))}toggleWith(t,i,e){this.get(t)===i?this.set(t,e):this.set(t,i)}true(t){return this.get(t)===!0}false(t){return this.get(t)===!1}is(t,i){return this.get(t)===i}remove(t){this.config.delete(t),this.editorContext.emit("config:"+t)}registerConfig(t){this.config.set(t.key,t.defaultValue),this.configList.push(t)}}class p{constructor(t){this.editorContext=t,this.plugins=[]}registerPlugin(t,i={}){this.plugins.push([t,i])}async initializePlugin(){return await Promise.all(this.plugins.map(async([t,i])=>{try{return await t(this.editorContext,i)}catch(e){console.error(e);return}}))}async activate(){await this.initializePlugin()}}class E{constructor(t){this.editorContext=t,this.uis={}}registerUI(t={}){Object.assign(this.uis,t)}getUI(t){return this.uis[t]}}const w="EditorContext";class b{constructor(t,i={}){this.$rootEditor=t,this.$options=i,this.initialize()}initialize(){const{managers:t={},configs:i=[],commands:e=[],plugins:a=[]}=this.$options;this.initializeManagers(t),this.initializeConfigs(i),this.initializeCommands(e),this.initializePlugins(a),this.emit("editor.initialize",this)}initializeManagers(t={}){t=c({configs:m,commands:C,plugins:p,uis:E},t),Object.entries(t).forEach(([i,e])=>{if(Object.hasOwnProperty.call(this,i)){console.warn(`[EditorContext] ${i} manager is already exists.`);return}Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:new e(this)})})}initializeConfigs(t=[]){t.forEach(i=>{this.configs.registerConfig(i)})}initializeCommands(t=[]){t.forEach(i=>{this.commands.registerCommand(i)})}initializePlugins(t=[]){t.forEach(i=>{this.plugins.registerPlugin(i)})}async activate(){return await this.plugins.activate()}get $store(){return this.$rootEditor.$store}emit(t,...i){this.$store.source=w,this.$store.emit(t,...i)}registerCommand(t){this.commands.registerCommand(t)}registerUI(t){this.uis.registerUI(t)}registerConfig(t){this.configs.registerConfig(t)}getUI(t){return this.uis.getUI(t)}getConfig(t){return this.configs.get(t)}}const h="editor",u="editorOption";class I{constructor(t,i={}){this.editor=t,this.props=i}initialize(){}load(){}activate(){}deactivate(){}}function l(){return n.useStore(h)}function x(r){var t;return(t=n.useStore(u))==null?void 0:t[r]}function O(r){var t,i;return(i=(t=l())==null?void 0:t.configs)==null?void 0:i.get(r)}function z(r,t){var i,e;return(e=(i=l())==null?void 0:i.configs)==null?void 0:e.set(r,t)}async function $(r,...t){var i,e;return await((e=(i=l())==null?void 0:i.commands)==null?void 0:e.emit(r,...t))}function v(r,t={}){var i,e;return(e=(i=l())==null?void 0:i.i18n)==null?void 0:e.get(r,t)}class g extends n.UIElement{initialize(){super.initialize(),this.$editor=new b(this,this.props),this.$store.set(h,this.$editor),this.$store.set(u,this.props),this.activate()}async activate(){await this.$editor.activate()}}class P extends g{template(){console.log("base editor render");const{content:t}=this.props,i=this.$editor.getUI("view");return n.createElementJsx("div",{class:n.classnames("elf--base-editor",c({"full-screen":this.props.fullScreen},this.props.editorClass))},t,n.createElementJsx(i,{type:"view"}))}}s.BaseEditor=P,s.Editor=g,s.EditorPlugin=I,s.useCommand=$,s.useConfig=O,s.useEditor=l,s.useEditorOption=x,s.useI18n=v,s.useSetConfig=z,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
