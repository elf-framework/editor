(function(r,s){typeof exports=="object"&&typeof module!="undefined"?s(exports,require("@elf-framework/sapa")):typeof define=="function"&&define.amd?define(["exports","@elf-framework/sapa"],s):(r=typeof globalThis!="undefined"?globalThis:r||self,s(r.baseEditor={},r.sapa))})(this,function(r,s){"use strict";var z=Object.defineProperty;var u=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var g=(r,s,n)=>s in r?z(r,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[s]=n,l=(r,s)=>{for(var n in s||(s={}))v.call(s,n)&&g(r,n,s[n]);if(u)for(var n of u(s))I.call(s,n)&&g(r,n,s[n]);return r};var n="";class d{constructor(t){this.editorContext=t,this.localCommands={}}loadCommands(t={}){Object.keys(t).forEach(i=>{s.isFunction(t[i])?this.registerCommand(i,t[i]):this.registerCommand(t[i])})}registerCommand(t,i){if(this.localCommands[t])throw new Error(`command ${t} is already registered`);if(arguments.length===2){const e=(...o)=>i.call(this,this.editorContext,...o);e.source=t,this.localCommands[t]=e}else if(s.isObject(t)){if(!t.command)throw new Error("command is required",t);if(!t.execute)throw new Error("callback is required",t);const e=(...o)=>t.execute.call(t,this.editorContext,...o);e.source=t.command,this.localCommands[t.command]=e}}getCallback(t){return this.localCommands[t]}emit(t,...i){const e=this.getCallback(t);if(e)return e(...i)}}class f{constructor(t){this.editorContext=t,this.configList=[],this.config=new Map}get(t){var i;return this.config.has(t)===!1&&this.config.set(t,(i=this.configList.find(e=>e.key==t))==null?void 0:i.defaultValue),this.config.get(t)}set(t,i){const e=this.config.get(t);e!==i&&(this.config.set(t,i),this.editorContext.emit("config:"+t,i,e))}push(t,i){const o=this.get(t).length;return this.setIndexValue(t,o,i),o}setIndexValue(t,i,e){const o=this.get(t);o[i]=e,this.set(t,[...o])}getIndexValue(t,i){return this.get(t)[i]}removeByIndex(t,i){const e=this.get(t);e.splice(i,1),this.set(t,[...e])}init(t,i){this.set(t,i,!1)}setAll(t){Object.keys(t).forEach(i=>{this.set(i,t[i])})}getType(t){var i;return(i=this.configList.find(e=>e.key==t))==null?void 0:i.type}isType(t,i){return this.getType(t)===i}isBoolean(t){return this.isType(t,"boolean")}toggle(t){this.set(t,!this.get(t))}toggleWith(t,i,e){this.get(t)===i?this.set(t,e):this.set(t,i)}true(t){return this.get(t)===!0}false(t){return this.get(t)===!1}is(t,i){return this.get(t)===i}remove(t){this.config.delete(t),this.editorContext.emit("config:"+t)}registerConfig(t){this.config.set(t.key,t.defaultValue),this.configList.push(t)}}class p{constructor(t){this.editorContext=t,this.plugins=[]}registerPlugin(t,i={}){this.plugins.push([t,i])}async initializePlugin(){return await Promise.all(this.plugins.map(async([t,i])=>{try{return await t(this.editorContext,i)}catch(e){console.error(e);return}}))}async activate(){await this.initializePlugin()}}class m{constructor(t){this.editorContext=t,this.uis={}}registerUI(t={}){Object.assign(this.uis,t)}getUI(t){return this.uis[t]}}class C{constructor(t,i={}){this.$rootEditor=t,this.$options=i,this.initialize()}initialize(){const{managers:t={},configs:i=[],commands:e=[],plugins:o=[]}=this.$options;this.initializeManagers(t),this.initializeConfigs(i),this.initializeCommands(e),this.initializePlugins(o),this.emit("editor.initialize",this)}initializeManagers(t={}){t=l({configs:f,commands:d,plugins:p,uis:m},t),Object.entries(t).forEach(([i,e])=>{if(Object.hasOwnProperty.call(this,i)){console.warn(`[EditorContext] ${i} manager is already exists.`);return}Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:new e(this)})})}initializeConfigs(t=[]){t.forEach(i=>{this.configs.registerPlugin(i)})}initializeCommands(t=[]){t.forEach(i=>{this.commands.registerPlugin(i)})}initializePlugins(t=[]){t.forEach(i=>{this.plugins.registerPlugin(i)})}async activate(){return await this.plugins.activate()}get $store(){return this.$rootEditor.$store}emit(t,...i){this.$store.emit(t,...i)}registerCommand(t){this.commands.registerCommand(t)}registerUI(t){this.uis.registerUI(t)}getUI(t){return this.uis.getUI(t)}}const c="editor";class E{constructor(t,i={}){this.editor=t,this.props=i}initialize(){}load(){}activate(){}deactivate(){}}function w(){return s.useStore(c)}class h extends s.UIElement{initialize(){super.initialize(),this.$editor=new C(this,this.props),this.$store.set(c,this.$editor),this.activate()}async activate(){await this.$editor.activate()}}class x extends h{template(){console.log("base editor render");const{content:t}=this.props,i=this.$editor.getUI("view");return s.createElementJsx("div",{class:s.classnames("elf--base-editor",l({"full-screen":this.props.fullScreen},this.props.editorClass))},t,s.createElementJsx(i,{type:"view"}))}}r.BaseEditor=x,r.Editor=h,r.EditorPlugin=E,r.useEditor=w,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
