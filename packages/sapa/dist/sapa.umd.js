var Li=Object.defineProperty,Ii=Object.defineProperties;var ki=Object.getOwnPropertyDescriptors;var De=Object.getOwnPropertySymbols;var Mi=Object.prototype.hasOwnProperty,_i=Object.prototype.propertyIsEnumerable;var Vt=(r,u,E)=>u in r?Li(r,u,{enumerable:!0,configurable:!0,writable:!0,value:E}):r[u]=E,yt=(r,u)=>{for(var E in u||(u={}))Mi.call(u,E)&&Vt(r,E,u[E]);if(De)for(var E of De(u))_i.call(u,E)&&Vt(r,E,u[E]);return r},Kt=(r,u)=>Ii(r,ki(u));var Wt=(r,u,E)=>(Vt(r,typeof u!="symbol"?u+"":u,E),E),zt=(r,u,E)=>{if(!u.has(r))throw TypeError("Cannot "+E)};var m=(r,u,E)=>(zt(r,u,"read from private field"),E?E.call(r):u.get(r)),C=(r,u,E)=>{if(u.has(r))throw TypeError("Cannot add the same private member more than once");u instanceof WeakSet?u.add(r):u.set(r,E)},b=(r,u,E,S)=>(zt(r,u,"write to private field"),S?S.call(r,E):u.set(r,E),E),Be=(r,u,E,S)=>({set _(ct){b(r,u,ct,E)},get _(){return m(r,u,S)}}),lt=(r,u,E)=>(zt(r,u,"access private method"),E);(function(r,u){typeof exports=="object"&&typeof module!="undefined"?u(exports):typeof define=="function"&&define.amd?define(["exports"],u):(r=typeof globalThis!="undefined"?globalThis:r||self,u(r.sapa={}))})(this,function(r){var M,$,y,vt,nt,q,st,X,H,_,it,rt,Z,at,At,Ue,ot,jt,Nt,$e,G;"use strict";function u(s,t=()=>!0){let e=s,n=[];do{if(e instanceof Object===!1)break;const o=Object.getOwnPropertyNames(e).filter(t);n.push.apply(n,o)}while(e=Object.getPrototypeOf(e));return n}function E(s,t=0){if(t===0)return s;var e=void 0;return function(n,i,o,a,l){e&&window.clearTimeout(e),e=window.setTimeout(function(){s(n,i,o,a,l)},t||300)}}function S(s,t){var e=void 0;return function(n,i,o,a,l){e||(e=window.setTimeout(function(){s(n,i,o,a,l),e=null},t||300))}}function ct(s,t,e){return(...n)=>{e.every(o=>t[o].apply(t,n))&&s.apply(t,n)}}function Yt(s,t){return(...e)=>{s.requestAnimationFrameId&&cancelAnimationFrame(s.requestAnimationFrameId),s.requestAnimationFrameId=window.requestAnimationFrame(()=>{s.apply(t,e)})}}function Ot(s,t){Object.keys(s).forEach((e,n)=>{t(e,s[e],n)})}function qt(s,t){return Object.keys(s).map((e,n)=>t(e,s[e],n))}function He(s,t,e=""){return qt(s,t).join(e)}function Ge(s,t,e){var n=Xt(s[t],t);return v(e)?e(n):n}function Xt(s,t){return typeof s=="undefined"?t:s}function W(s){return typeof s=="undefined"}function D(s){return!W(s)}function Zt(s){return typeof s=="boolean"}function B(s){return typeof s=="string"}function Ve(s){return!B(s)}function St(s,t,e=0,n={}){if(e>5)throw console.error(s,t),new Error(["isEqual \uC744 \uC624\uB798 \uC2E4\uD589\uD558\uC600\uC2B5\uB2C8\uB2E4."]);const i=Object.keys(s),o=Object.keys(t);return i.length!==o.length?!1:i.every(a=>{if(n[a])return!0;const l=s[a],c=t[a];if(L(l)&&L(c)){const T=new Set([...l,...c]);return T.size===l.length&&T.size===c.length}else if(!(v(l)&&v(c))){if(U(l)&&U(c))return St(l,c,e+1,n)}return l===c})}function L(s){return Array.isArray(s)}function U(s){return typeof s=="object"&&!Array.isArray(s)&&!wt(s)&&!B(s)&&s!==null}function v(s){return typeof s=="function"}function wt(s){return typeof s=="number"}function Jt(s){return s===0}function Ke(s){return!Jt(s)}const We=s=>JSON.parse(JSON.stringify(s));function ze(s){if(!W(s))return We(s)}function je(s){return Object.keys(s).forEach(t=>{Array.isArray(s[t])&&(s[t]=s[t].join(", "))}),s}function Q(...s){const t=[];return s.filter(Boolean).forEach(e=>{L(e)?t.push(Q(...e)):U(e)?Object.keys(e).filter(n=>Boolean(e[n])).forEach(n=>{t.push(n)}):B(e)&&t.push(e)}),t.join(" ")}const Ye={checked:!0,disabled:!0,selected:!0,readonly:!0,required:!0,multiple:!0,open:!0,hidden:!0,spellcheck:!0,autofocus:!0,autoplay:!0,controls:!0,loop:!0,muted:!0,default:!0,defer:!0,async:!0,allowfullscreen:!0,allowtransparency:!0,allowpaymentrequest:!0};function Qt(s){return Ye[s]}const qe=(s,t,e)=>{D(e)?(s.setAttribute(t,t),s[t]=e):(s.removeAttribute(t),s[t]=void 0)},Xe=(s,t,e)=>{Qt(t)?qe(s,t,e):t==="style"?s.style.cssText=e:s.setAttribute(t,e)},Ze=(s,t)=>{console.log("removeProp",s,t),Qt(t)?(s.removeAttribute(t),s[t]=!1):t&&s.removeAttribute(t)},Je=(s,t,e,n)=>{console.log(s,t,e,W(e),n),W(e)?Ze(s,t):(!n||e!==n)&&Xe(s,t,e)},xt=(s,t={},e={})=>{const n=[],i=Object.keys(t),o=Object.keys(e);if(i.length===0&&o.length===0)return;n.push.apply(n,i),n.push.apply(n,o),new Set(n).forEach(l=>{Je(s,l,t[l],e[l])})};function Qe(s,t){return s.nodeType===window.Node.TEXT_NODE&&s.textContent!==t.textContent||s.nodeName!==t.nodeName}function te(s){return(s==null?void 0:s.nodeType)===8?!0:s.nodeType!==window.Node.TEXT_NODE&&s.getAttribute("data-domdiff-pass")==="true"}function ee(s){return s.nodeType!==window.Node.TEXT_NODE&&s.getAttribute("refclass")}function ht(s){var t={};const e=s.length;for(let n=0;n<e;n++){const i=s[n];i.name!=="has-event"&&(i.name.startsWith("on")||(t[i.name]=i.value))}return t}function ne(s,t,e,n,i={}){if(!t)s.appendChild(e.cloneNode(!0));else if(!e)s.removeChild(t);else if(!(te(t)||te(e))){if(Qe(e,t)||ee(e))t.nodeType===window.Node.TEXT_NODE&&e.nodeType!==window.Node.TEXT_NODE||t.nodeType!==window.Node.TEXT_NODE&&e.nodeType===window.Node.TEXT_NODE?(s.insertBefore(e.cloneNode(!0),t),s.removeChild(t)):ee(e)?v(i.checkRefClass)&&i.checkRefClass(t,e)&&(console.log("replace object refclass",t,e),t.replaceWith(e.cloneNode(!0))):t.replaceWith(e.cloneNode(!0));else if(e.nodeType!==window.Node.TEXT_NODE&&e.nodeType!==window.Node.COMMENT_NODE&&e.toString()!=="[object HTMLUnknownElement]"){i.checkPassed&&i.checkPassed(t,e)||xt(t,ht(e.attributes),ht(t.attributes));for(var o=ut(t),a=ut(e),l=Math.max(o.length,a.length),c=0;c<l;c++)ne(t,o[c],a[c],c,i)}}}const ut=s=>{var t=s.firstChild;if(!t)return[];var e=[];do e.push(t),t=t.nextSibling;while(t);return e},xe={checkPassed:void 0,keyField:"key",removedElements:[]};function ft(s,t,e={}){if(!s||!t)throw new Error("A and B must be defined");e=Kt(yt({},xe),{checkPassed:v(e.checkPassed)?e.checkPassed:void 0,checkRefClass:v(e.checkRefClass)?e.checkRefClass:void 0}),s=s.el||s,t=t.el||t;var n=ut(s),i=ut(t);s.nodeType!==11&&t.nodeType!==11&&xt(s,ht(t.attributes),ht(s.attributes));var o=Math.max(n.length,i.length);if(o!==0)if(n.length===0&&i.length>0){var a=document.createDocumentFragment();i.forEach(c=>a.appendChild(c)),s.appendChild(a)}else if(n.length>0&&i.length===0)s.textContent="";else for(var l=0;l<o;l++)ne(s,n[l],i[l],l,e)}const se=/[xy]/g;function Lt(){var s=new Date().getTime(),t="xxx12-xx-34xx".replace(se,function(e){var n=(s+Math.random()*16)%16|0;return s=Math.floor(s/16),(e=="x"?n:n&3|8).toString(16)});return t}function dt(){var s=new Date().getTime(),t="idxxxxxxx".replace(se,function(e){var n=(s+Math.random()*16)%16|0;return s=Math.floor(s/16),(e=="x"?n:n&3|8).toString(16)});return t}const gt={},Et={},ie={},re=new Set,I=new Map,z=new Map,ae="v:";function x(s,t=""){const e=`${ae}${dt()}`;return I.set(e,s),t&&(z.has(t)||z.set(t,new Set),z.get(t).add(e)),e}function tn(s){z.has(s)&&(z.get(s).forEach(t=>{I.delete(t)}),z.delete(s))}function mt(s,t=!0){if(B(s)===!1)return s;let e=s;return I.has(s)&&(e=I.get(s),t&&I.delete(s)),e}function tt(s){return I.has(s)?I.get(s):s}function oe(s){return I.has(s)}function le(s){return Object.entries(s).map(([t,e])=>`${t}=${x(e)}`).join(" ")}function ce(s={}){Object.keys(s).forEach(t=>{gt[t]=s[t]})}function he(s){gt[s.name]&&(gt[s.name]=s)}function en(s,t){ie[s]=t}function ue(s){return ie[s]}function fe(s){return gt[ue(s)||s]}function de(s){re.add(s)}function ge(){return[...re]}function nn(s){he(s),ge().forEach(t=>{t.hmr()})}function sn(s){Object.keys(s).forEach(t=>{Et[t]=s[t]})}function rn(s){return Et[s]}function Ee(s,t={}){return[...Object.keys(Et).map(e=>{const n=Et[e];return new n(s)}),...Object.keys(t).map(e=>{const n=t[e];return new n(s)})]}class d{constructor(t,e,n){if(typeof t!="string")t instanceof d?this.el=t.el:this.el=t;else{var i=document.createElement(t);e&&(i.className=e),n=n||{},Object.assign(i,n),this.el=i}}static create(t,e,n){return new d(t,e,n)}static createByHTML(t){var e=d.create("div");return e.html(t).firstChild}static makeElementList(t){const e=d.create("div");let n=[];L(t)||(t=[t]),t=t.filter(Boolean);for(let i=0,o=t.length;i<o;i++){const a=t[i];B(a)?n.push(...e.html(a==null?void 0:a.trim()).childNodes||[]):a&&n.push(d.create(a))}return n}static getScrollTop(){return Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop)}static getScrollLeft(){return Math.max(window.pageXOffset,document.documentElement.scrollLeft,document.body.scrollLeft)}static parse(t){var e=window.DOMParser();return e.parseFromString(t,"text/htmll")}static body(){return d.create(document.body)}get exists(){return Boolean(this.el)}setAttr(t){return Object.keys(t).forEach(e=>{this.attr(e,t[e])}),this}setAttrNS(t,e="http://www.w3.org/2000/svg"){return Object.keys(t).forEach(n=>{this.attr(n,t[n],e)}),this}setProp(t){return Object.keys(t).forEach(e=>{this.el[e]!=t[e]&&(this.el[e]=t[e])}),this}data(t,e){if(arguments.length===1){const n=this.attr("data-"+t);return mt(n,!1)}else if(arguments.length===2)return this.attr("data-"+t,e);return this}attr(...t){return t.length==1?v(this.el.getAttribute)&&this.el.getAttribute(t[0]):(this.el.getAttribute(t[0])!=t[1]&&this.el.setAttribute(t[0],t[1]),this)}attrNS(t,e,n="http://www.w3.org/2000/svg"){return arguments.length==1?this.el.getAttributeNS(n,t):(this.el.getAttributeNS(n,t)!=e&&this.el.setAttributeNS(n,t,e),this)}attrKeyValue(t){return{[this.el.getAttribute(t)]:this.val()}}get attributes(){try{return[...this.el.attributes]}catch{const n=this.el.attributes.length,i=[];for(var t=0;t<n;t++)i.push(this.el.attributes[`${t}`]);return i}}attrs(...t){return t.map(e=>this.el.getAttribute(e))}styles(...t){return t.map(e=>this.el.style[e])}removeAttr(t){return this.el.removeAttribute(t),this}removeStyle(t){return this.el.style.removeProperty(t),this}get isFragment(){return this.el.nodeType===11}get isTemplate(){return this.el.nodeType===1&&this.el.tagName==="TEMPLATE"}get content(){return this.isTemplate?this.el.content:this.el}is(t){return t instanceof d?this.el===t.el:this.el===t}isTag(t){return this.el.tagName.toLowerCase()===t.toLowerCase()}closest(t){for(var e=this,n=!1;!(n=e.hasClass(t));)if(e.el.parentNode)e=d.create(e.el.parentNode);else return null;return n?e:null}path(){if(!this.el)return[];let t=[this],e=this.parent();if(!e.el)return t;for(;e&&(t.unshift(e),e=e.parent(),!!e.el););return t}get $parent(){return this.parent()}parent(){return d.create(this.el.parentNode)}hasParent(){return!!this.el.parentNode}get isUnlinked(){return!this.el.parentNode}removeClass(...t){return this.el.classList.remove(...t),this}updateClass(t){return this.el.className=t,this}replaceClass(t,e){return this.el.classList.replace(t,e),this}hasClass(t){return this.el.classList?this.el.classList.contains(t):!1}addClass(...t){return this.el.classList.add(...t),this}onlyOneClass(t){var e=this.parent();e.children().forEach(n=>{n.removeClass(t)}),this.addClass(t)}toggleClass(t,e){return this.el.classList.toggle(t,e),this}outerHTML(){return this.isTextNode?this.text():this.el.outerHTML}html(t){try{return typeof t=="undefined"?this.el.innerHTML:(typeof t=="string"?Object.assign(this.el,{innerHTML:t}):this.empty().append(t),this)}catch(e){return console.log(e,t),this}}htmlDiff(t,e={}){ft(this,t,e)}updateDiff(t,e="div",n={}){ft(this,d.create(e).html(t),n)}updateSVGDiff(t,e="div",n={}){ft(this,d.create(e).html(`<svg>${t}</svg>`).firstChild.firstChild,n)}getById(t){return this.el.getElementById(t)}find(t,e=this.el){if(!this.isTextNode)return e.querySelector(t)}$(t){var e=this.find(t,this.isTemplate?this.el.content:this.el);return e?d.create(e):null}findAll(t,e=this.el){return this.isTextNode?[]:Array.from(e.querySelectorAll(t))}$$(t){var e=this.findAll(t,this.isTemplate?this.el.content:this.el);return e.map(n=>d.create(n))}empty(){for(;this.el.firstChild;)this.el.removeChild(this.el.firstChild);return this}append(t){return t?(L(t)?this.el.append(...t.map(e=>e.el||e)):typeof t=="string"?this.el.appendChild(document.createTextNode(t)):this.el.appendChild(t.el||t),this):this}prepend(t){return typeof t=="string"?this.el.prepend(document.createTextNode(t)):this.el.prepend(t.el||t),this}prependHTML(t){var e=d.create("div").html(t);return this.prepend(e.createChildrenFragment()),e}appendHTML(t){var e=d.create("div").html(t);return this.append(e.createChildrenFragment()),e}createChildrenFragment(){const t=this.childNodes;var e=document.createDocumentFragment();return t.forEach(n=>e.appendChild(n.el)),e}static createFragment(t=[]){var e=document.createDocumentFragment();return t.forEach(n=>e.appendChild(n)),e}appendTo(t){var e=t.el?t.el:t;return e.appendChild(this.el),this}remove(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this}removeChild(t){return this.el.removeChild(t.el||t),this}text(t){if(typeof t=="undefined")return this.el.textContent;var e=t;return t instanceof d&&(e=t.text()),this.el.textContent!==e&&(this.el.textContent=e),this}css(t,e){if(typeof t!="undefined"&&typeof e!="undefined")t.indexOf("--")===0&&typeof e!="undefined"?this.el.style.setProperty(t,e):this.el.style[t]=e;else if(typeof t!="undefined"){if(typeof t=="string")return window.getComputedStyle(this.el)[t];Object.entries(t).forEach(([n,i])=>{n.indexOf("--")===0&&typeof i!="undefined"?this.el.style.setProperty(n,i):this.el.style[n]=i})}return this}getComputedStyle(...t){var e=window.getComputedStyle(this.el),n={};return t.forEach(i=>{n[i]=e[i]}),n}getStyleList(...t){for(var e={},n=this.el.style.length,i=0;i<n;i++){var o=this.el.style[i];e[o]=this.el.style[o]}return t.forEach(a=>{e[a]=this.css(a)}),e}cssText(t){return typeof t=="undefined"?this.el.style.cssText:(t!=this.el.tempCssText&&(this.el.style.cssText=t,this.el.tempCssText=t),this)}cssArray(t){return t[0]&&(this.el.style[t[0]]=t[1]),t[2]&&(this.el.style[t[2]]=t[3]),t[4]&&(this.el.style[t[4]]=t[5]),t[6]&&(this.el.style[t[6]]=t[7]),t[8]&&(this.el.style[t[8]]=t[9]),this}cssFloat(t){return parseFloat(this.css(t))}cssInt(t){return parseInt(this.css(t))}px(t,e){return this.css(t,`${e}px`)}rect(){return this.el.getBoundingClientRect()}bbox(){return this.el.getBBox()}isSVG(){return this.el._cachedIsSVG||(this.el._cachedIsSVG={value:this.el.tagName.toLowerCase()==="svg"}),this.el._cachedIsSVG.value}offsetRect(){if(this.isSVG()){const e=this.parent().rect(),n=this.rect();return{x:n.x-e.x,y:n.y-e.y,width:n.width,height:n.height}}const t=this.el;return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight}}offsetClientRect(){if(this.isSVG()){const n=this.parent().rect(),i=this.rect();return{x:i.x-n.x,y:i.y-n.y,width:i.width,height:i.height}}const t=this.parent().rect(),e=this.rect();return{x:e.x-t.x,y:e.y-t.y,width:e.width,height:e.height}}offset(){var t=this.rect(),e=d.getScrollTop(),n=d.getScrollLeft();return{top:t.top+e,left:t.left+n}}offsetLeft(){return this.offset().left}offsetTop(){return this.offset().top}position(){return this.el.style.top?{top:parseFloat(this.css("top")),left:parseFloat(this.css("left"))}:this.rect()}size(){return[this.width(),this.height()]}width(){return this.el.offsetWidth||this.rect().width}contentWidth(){return this.width()-this.cssFloat("padding-left")-this.cssFloat("padding-right")}height(){return this.el.offsetHeight||this.rect().height}contentHeight(){return this.height()-this.cssFloat("padding-top")-this.cssFloat("padding-bottom")}val(t){if(typeof t=="undefined")return this.el.value;if(typeof t!="undefined"){var e=t;t instanceof d&&(e=t.val()),this.el.value=e}return this}matches(t){return this.el&&this.el.matches?this.el.matches(t)?this:this.parent().matches(t):null}get value(){return this.el.value}set value(t){this.el.value=t}get naturalWidth(){return this.el.naturalWidth}get naturalHeight(){return this.el.naturalHeight}get files(){return this.el.files?[...this.el.files]:[]}get isTextNode(){return this.el.nodeType===3}realVal(){switch(this.el.nodeType){case"INPUT":var t=this.attr("type");return t=="checkbox"||t=="radio"?this.checked():this.el.value;case"SELECT":case"TEXTAREA":return this.el.value}return""}int(){return parseInt(this.val(),10)}float(){return parseFloat(this.val())}show(t="block"){return this.el.style.display=t!="none"?t:"block",this}hide(){return this.el.style.display="none",this}isHide(){return this.el.style.display==="none"}isShow(){return!this.isHide()}toggle(t){var e=this.isHide();return arguments.length==1?t?this.show():this.hide():e?this.show():this.hide()}get totalLength(){return this.el.getTotalLength()}scrollIntoView(){this.el.scrollIntoView()}addScrollLeft(t){return this.el.scrollLeft+=t,this}addScrollTop(t){return this.el.scrollTop+=t,this}setScrollTop(t){return this.el.scrollTop=t,this}setScrollLeft(t){return this.el.scrollLeft=t,this}scrollTop(){return this.el===document.body?d.getScrollTop():this.el.scrollTop}scrollLeft(){return this.el===document.body?d.getScrollLeft():this.el.scrollLeft}scrollHeight(){return this.el.scrollHeight}scrollWidth(){return this.el.scrollWidth}on(t,e,n,i){return this.el.addEventListener(t,e,n,i),this}off(t,e){return this.el.removeEventListener(t,e),this}getElement(){return this.el}createChild(t,e="",n={},i={}){let o=d.create(t,e,n);return o.css(i),this.append(o),o}get firstChild(){return d.create(this.el.firstElementChild)}get first(){return d.create(this.el.firstChild)}children(){var t=this.el.firstElementChild;if(!t)return[];var e=[];do e.push(d.create(t)),t=t.nextElementSibling;while(t);return e}hasChild(t){const e=t.el||t;return this.el===e?!1:this.el.contains(e)}get childNodes(){const t=[];if(this.el.hasChildNodes()){const e=this.el.childNodes;for(let n=0;n<e.length;n++)t.push(d.create(e[n]))}return t}childLength(){return this.el.children.length}replace(t){return this.el.parentNode&&this.el.parentNode.replaceChild(t.el||t,this.el),this}replaceChild(t,e){return this.el.replaceChild(e.el||e,t.el||t),this}checked(t=!1){return arguments.length==0?!!this.el.checked:(this.el.checked=!!t,this)}click(){return this.el.click(),this}focus(){return this.el.focus(),this}select(){if(this.attr("contenteditable")==="true"){var t=document.createRange();t.selectNodeContents(this.el);var e=window.getSelection();e.removeAllRanges(),e.addRange(t)}else this.el.select();return this}blur(){return this.el.blur(),this}toDataURL(t="image/png",e=1){return this.el.toDataURL(t,e)}fullscreen(){var t=this.el;t.requestFullscreen?t.requestFullscreen():t.wekitRequestFullscreen&&t.wekitRequestFullscreen()}toggleFullscreen(){this.el===document.fullscreenElement?document.exitFullscreen():this.fullscreen()}}class j{constructor(t,e={}){this.context=t,this.options=e}initialize(){}load(){}refresh(){}render(){}getRef(t){return this.context.getRef(t)}run(){}destroy(){}}class an{constructor(){this.handlers=this.initializeHandler()}initializeHandler(t={}){return Ee(this,t)}async runHandlers(t="run",...e){await Promise.all(this.handlers.filter(n=>n[t]).map(async n=>{await n[t](...e)}))}}class me{constructor(t){this.id=dt(),this.cachedCallback={},this.callbacks={},this.editor=t}getCallbacks(t){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t]}setCallbacks(t,e=[]){this.callbacks[t]=e}debug(...t){this.editor&&this.editor.context.config.get("debug.mode")&&console.debug(...t)}on(t,e,n,i=0,o=0,a=!1,l=!1,c=[],T=!1){var g=e;return i>0?g=E(e,i):o>0&&(g=S(e,o)),c.length&&(g=ct(g,n,c)),T&&(g=Yt(g,n,e.name)),this.getCallbacks(t).push({event:t,callback:g,context:n,originalCallback:e,enableAllTrigger:a,enableSelfTrigger:l}),()=>{this.off(t,e)}}off(t,e){this.debug("off message event",t),arguments.length==1?this.setCallbacks(t):arguments.length==2&&this.setCallbacks(t,this.getCallbacks(t).filter(n=>n.originalCallback!==e))}offAll(t){Object.keys(this.callbacks).forEach(e=>{this.setCallbacks(e,this.getCallbacks(e).filter(n=>n.context!==t))}),this.debug("off all message",t.sourceName)}getCachedCallbacks(t){return this.getCallbacks(t)}sendMessage(t,e,...n){this.sendMessageList(t,[[e,...n]])}runMessage(t,e){const n=t.callback.apply(t.context,e);if(D(n)){if(n===!1)return;if(v(n)){n();return}}}sendMessageList(t,e=[]){window.Promise.resolve().then(()=>{e.forEach(([n,...i])=>{var o=this.getCachedCallbacks(n);if(o&&o.length){const a=o.filter(c=>!c.enableSelfTrigger).filter(c=>c.enableAllTrigger||c.originalCallback.source!==t);let l=a.length;for(;l--;){const c=a[l];this.runMessage(c,i)}}else this.debug(`message event ${n} is not exist.`)})})}nextSendMessage(t,e,...n){window.Promise.resolve().then(()=>{e(...n)})}triggerMessage(t,e,...n){window.Promise.resolve().then(()=>{var i=this.getCachedCallbacks(e);i?i.filter(a=>a.originalCallback.source===t).forEach(a=>{a.callback.apply(a.context,n)}):this.debug(e," is not valid event")})}emit(t,...e){v(t)?t(...e):L(t)?this.sendMessageList(this.source,t):this.sendMessage(this.source,t,...e)}nextTick(t){this.nextSendMessage(this.source,t)}trigger(t,...e){v(t)?t(...e):this.triggerMessage(this.source,t,...e)}}const It=/^@magic:([a-zA-Z][a-zA-Z0-9]*)[\W]{1}(.*)*$/g,kt="@magic:",k="|",pe=/(([\$a-z_\-]+)\([^\(\)]*\)|([a-z_\-]+))/gi,Mt="(",Te=")",pt={KEYWORD:"keyword",FUNCTION:"function",VALUE:"value"};class R{constructor(t){this.context=t.context,this.originalMethod=t.originalMethod,this.method=t.method,this.args=t.args,this.pipes=t.pipes,this.keys=t.keys,this.__cache=new Map}setCache(t,e){this.__cache.set(t,e)}hasCache(t){return this.__cache.has(t)}getCache(t){return this.__cache.get(t)}hasKeyword(t){if(this.hasCache(t))return this.getCache(t);let e=!1;return this.pipes.forEach(n=>{switch(n.type){case pt.KEYWORD:n.value===t&&(e=!0);break}}),this.setCache(t,e),e}hasFunction(t){if(this.hasCache(t))return this.getCache(t);let e=!!this.getFunction(t);return this.setCache(t,e),e}getFunction(t){return this.functions.find(e=>e.func===t)}getFunctionList(t){return this.functions.filter(e=>e.func===t)}get originalCallback(){return this.context[this.originalMethod]}get keywords(){return this.keys[pt.KEYWORD].map(t=>t.value)}get functions(){return this.keys[pt.FUNCTION]}get values(){return this.keys[pt.VALUE].map(t=>t.value)}execute(...t){return this.originalCallback.call(this.context,...t)}executeWithContext(t,...e){return this.originalCallback.call(t,...e)}static make(t,...e){return`${kt}${t} ${e.join(k)}`}static check(t){return t.match(It)!==null}static parse(t,e={}){const n=t.match(It);if(!n)return;const i=n[0].split(kt)[1].split(k).map(p=>p.trim());let[o,...a]=i;const[l,...c]=o.split(" "),T=a.map(p=>this.parsePipe(p)).filter(p=>p.value),g={function:[],keyword:[],value:[]};return T.forEach(p=>{p.type==="function"?g.function.push(p):p.type==="keyword"?g.keyword.push(p):g.value.push(p)}),new R({context:e,originalMethod:t,method:l,args:c,pipes:T,keys:g})}static parsePipe(t){const e=t.match(pe);if(!e)return{type:"value",value:t};const[n]=e;if(n.includes(Mt)){const[i,o]=n.split(Mt),[a]=o.split(Te);return{type:"function",value:n,func:i,args:a.split(",").map(l=>l.trim()).filter(Boolean)}}return{type:"keyword",value:e[0]}}}const Ce=(s,t=k)=>` ${t} ${s}`,on="ME@",be=(...s)=>s.join(k),_t=(...s)=>on+be(...s),ln=_t,cn=_t,Tt=":",ve=" ",hn={},h=(...s)=>{var t=s.join(Tt);return(...e)=>{const[n,...i]=e;return R.make("domevent",[t,n].join(" "),...i)}},Ct=(...s)=>R.make("subscribe",...s),un=(...s)=>R.make("callback",...s),fn=(...s)=>R.make("observer",...s),f=(s,t=k)=>Ce(s,t),Ft=(s,t=k)=>f(`after(${s})`,t),dn=(s,t=k)=>f(`before(${s})`,t),gn=f,En=f,mn=f("ArrowUp"),pn=f("ArrowDown"),Tn=f("ArrowLeft"),Cn=f("ArrowRight"),bn=f("Enter"),vn=f("Space"),An=f("Escape"),Nn=f("Backspace"),Rn=f("Delete"),yn=f("Equal"),On=f("Minus"),Sn=f("BracketRight"),wn=f("BracketLeft"),Ln=f("isAltKey"),In=f("isShiftKey"),kn=f("isMetaKey"),Mn=f("isCtrlKey"),_n=f("hasMouse"),Fn=f("hasTouch"),Pn=f("hasPen"),Dn=f("self"),Ae=f("isMouseLeftButton"),Bn=f("isMouseRightButton"),Un=f("fit"),$n=f("passive"),Hn=f("domdiff"),Ne=(s=100)=>f(`debounce(${s})`),Gn=(s=300)=>f(`delay(${s})`),Vn=Ne(1e3),Kn=(s=100)=>f(`throttle(${s})`),Re=f("allTrigger()"),ye=f("selfTrigger()"),Wn=f("frame()"),zn=s=>f(`params(${x(s)})`),jn=f("capture()"),Yn=Ft("preventDefault"),qn=Ft("stopPropagation"),Xn=Ct,Zn=(...s)=>Ct(...s,Re),Jn=(...s)=>Ct(...s,ye),Qn=(s,...t)=>Ct(`config:${s}`,...t),Oe=un,xn=Oe("requestAnimationFrame"),ts=fn,N=h,es=h("click"),ns=h("dblclick"),ss=h("mousedown"),is=h("mouseup"),rs=h("mousemove"),as=h("mouseover"),os=h("mouseout"),ls=h("mouseenter"),cs=h("mouseleave"),hs=h("touchstart"),us=h("touchmove"),fs=h("touchend"),ds=h("keydown"),gs=h("keyup"),Es=h("keypress"),ms=h("drag"),ps=h("dragstart"),Ts=h("drop"),Cs=h("dragover"),bs=h("dragenter"),vs=h("dragleave"),As=h("dragexit"),Ns=h("dragout"),Rs=h("dragend"),ys=h("contextmenu"),Os=h("change"),Ss=h("input"),ws=h("focus"),Ls=h("focusin"),Is=h("focusout"),ks=h("blur"),Ms=h("paste"),_s=h("resize"),Fs=h("scroll"),Ps=h("submit"),Ds=(...s)=>N("pointerdown")(...s)+Ae,Bs=N("pointerover"),Us=N("pointerenter"),$s=N("pointerout"),Hs=N("pointerleave"),Gs=N("pointermove"),Vs=N("pointerup"),Ks=N("change","input"),Ws=N("wheel","mousewheel","DOMMouseScroll"),zs=h("animationstart"),js=h("animationend"),Ys=h("animationiteration"),qs=h("transitionstart"),Xs=h("transitionend"),Zs=h("transitionrun"),Js=h("transitioncancel"),Qs=N("doubletab"),xs=N("popstate"),ti=N("orientationchange"),ei=N("hashchange"),ni=(s="$el")=>R.make("load",s),si=s=>hn[s]||"",Se=s=>function(){return this.prevState[s]!=this.state[s]},we=()=>!0,ii=(s="$el")=>R.make("bind",s);function ri(s){let t=s.deltaX,e=s.deltaY;return t===0&&s.shiftKey&&([e,t]=[t,e]),s.deltaMode===window.WheelEvent.DOM_DELTA_LINE?e*=8:s.deltaMode===window.WheelEvent.DOM_DELTA_PAGE&&(e*=24),[Le(t,24),Le(e,24),0]}function Le(s,t){return Math.sign(s)*Math.min(t,Math.abs(s))}var Pt={addDomEvent(s,t,e,n=!1){s&&s.addEventListener(t,e,n)},removeDomEvent(s,t,e){s&&s.removeEventListener(t,e)},pos(s){return s.touches&&s.touches[0]?s.touches[0]:s},posXY(s){var t=this.pos(s);return{x:t.pageX,y:t.pageY}}};const ai=(s,t)=>{if(wt(t))switch(s){case"width":case"height":case"top":case"left":case"right":case"bottom":return t+"px"}return t},oi=(s,t,e,n=!1)=>{if(t==="cssText"){s.cssText(e);return}else if(t==="style"){if(typeof e!="string"){const i={};if(Object.entries(e).forEach(([o,a])=>{i[o]=ai(o,a)}),n){const o=Object.keys(i).map(a=>`${a}:${i[a]};`).join("");s.attr("style",o)}else Object.keys(i).length>0&&s.css(i)}return}else if(t==="class"){Array.isArray(e)?s.updateClass(Q(...e)):s.updateClass(Q(e));return}else if(t==="callback"&&typeof e=="function"){e();return}typeof e=="undefined"?s.removeAttr(t):s.el.nodeName==="TEXTAREA"&&t==="value"||t==="text"||t==="textContent"?s.text(e):t==="innerHTML"||t==="html"?s.html(e):t==="htmlDiff"?s.updateDiff(e):t==="svgDiff"?s.updateSVGDiff(e):t==="value"?s.val(e):s.attr(t,e)},Dt={};class li extends j{async initialize(){Dt[this.context.sourceName]||(Dt[this.context.sourceName]=this.context.filterMethodes("bind"))}getBindMethods(){return Dt[this.context.sourceName]||[]}async bindData(...t){const e=this.getBindMethods();if(!(e!=null&&e.length))return;const n=e==null?void 0:e.filter(i=>t.length?t.indexOf(i.args[0])>-1:!0);await Promise.all(n==null?void 0:n.map(async i=>{let o=this.getRef(`${i.keywords[0]}`),a=we;typeof o=="string"&&o!==""?a=Se(o):typeof o=="function"&&(a=o);const l=i.args[0];let c=this.context.refs[l];const T=typeof a=="function"&&a.call(this.context);if(c&&T){const A=await i.executeWithContext(this.context,...t);if(!A)return;const V=Object.keys(A);for(var g=0,p=V.length;g<p;g++){const K=V[g],J=A[K];oi(c,K,J,this.context.isServer)}}}))}destroy(){this._bindMethods=void 0}}class ci extends j{initialize(){var t,e;this.destroy(),this._callbacks||(this._callbacks=this.context.filterMethodes("callback")),!((t=this._bindings)!=null&&t.length)&&((e=this._callbacks)==null?void 0:e.length)&&this._callbacks.forEach(n=>this.parseCallback(n))}destroy(){this.context.notEventRedefine||this.removeCallbackAll()}getCallback(t){return this.context[t]}removeCallbackAll(){this.getBindings().forEach(t=>{this.removeCallback(t)}),this.initBindings()}removeCallback({requestId:t}){window.cancelAnimationFrame(t)}getBindings(){return this._bindings||this.initBindings(),this._bindings}addBinding(t){this.getBindings().push(t)}initBindings(){this._bindings=[]}makeCallback(t){const e=t.callback,n=i=>{e(i),t.requestId=window.requestAnimationFrame(n)};return()=>{t.requestId=window.requestAnimationFrame(n)}}addCallback(t,e){const n=this.makeCallback(t,e);this.addBinding(t),n()}bindingCallback(t,e){var c,T;const n={eventName:t.args[0],callback:e};n.codes=[],n.checkMethodList=[];const i=t.getFunction("debounce"),o=t.getFunction("throttle");if(i){var a=+(((c=i.args)==null?void 0:c[0])||0);n.callback=E(e,a)}else if(o){var l=+(((T=o.args)==null?void 0:T[0])||0);n.callback=S(e,l)}t.keywords.forEach(g=>{const p=g;this.getCallback(p)?n.checkMethodList.push(p):n.codes.push(p.toLowerCase())}),this.addCallback(n,t)}parseCallback(t){const e=this.context;var n=t.args;if(n){var i=e[t.originalMethod].bind(e);this.bindingCallback(t,i)}}}const hi={touchstart:!0,touchmove:!0,mousedown:!0,mouseup:!0,mousemove:!0},ui={doubletab:"touchend"},fi={doubletab:!0},di={self(s){return s&&s.$dt&&s.$dt.is(s.target)},isAltKey(s){return s.altKey},isCtrlKey(s){return s.ctrlKey},isShiftKey(s){return s.shiftKey},isMetaKey(s){return s.metaKey||s.key=="Meta"||s.code.indexOf("Meta")>-1},isMouseLeftButton(s){return s.buttons===1},isMouseRightButton(s){return s.buttons===2},hasMouse(s){return s.pointerType==="mouse"},hasTouch(s){return s.pointerType==="touch"},hasPen(s){return s.pointerType==="pen"},preventDefault(s){return s.preventDefault(),!0},stopPropagation(s){return s.stopPropagation(),!0}};class gi extends j{initialize(){var t,e;this.destroy(),!(this._domEvents&&this.context.notEventRedefine)&&((!this._domEvents||this._domEvents.length===0||this._bindings.length===0)&&(this._domEvents=this.context.filterMethodes("domevent")),!((t=this._bindings)!=null&&t.length)&&((e=this._domEvents)==null?void 0:e.length)&&this._domEvents.forEach(n=>this.parseDomEvent(n)))}destroy(){this.context.notEventRedefine||this.removeEventAll()}getCallback(t){return this.context[t]||di[t]}removeEventAll(){this.getBindings().forEach(t=>{this.removeDomEvent(t)}),this.initBindings()}removeDomEvent({eventName:t,dom:e,callback:n}){Pt.removeDomEvent(e,t,n)}getBindings(){return this._bindings||this.initBindings(),this._bindings}addBinding(t){this.getBindings().push(t)}initBindings(){this._bindings=[]}matchPath(t,e){return t?t.matches(e)?t:this.matchPath(t.parentElement,e):null}hasDelegate(t,e){return this.matchPath(t.target||t.srcElement,e.delegate)}makeCallback(t,e,n){return t.delegate?this.makeDelegateCallback(t,e,n):this.makeDefaultCallback(t,e,n)}makeDefaultCallback(t,e,n){return i=>{var o=this.runEventCallback(i,t,e,n);if(D(o))return o}}makeDelegateCallback(t,e,n){return i=>{const o=this.hasDelegate(i,t);if(o){i.$dt=d.create(o);var a=this.runEventCallback(i,t,e,n);if(D(a))return a}}}runEventCallback(t,e,n,i){const o=this.context;if(t.xy=Pt.posXY(t),e.beforeMethods.length&&e.beforeMethods.every(l=>this.getCallback(l.target).call(o,t,l.param)),this.checkEventType(t,e)){var a=i(t,t.$dt,t.xy);return a!==!1&&e.afterMethods.length&&e.afterMethods.forEach(l=>this.getCallback(l.target).call(o,t,l.param)),a}}checkEventType(t,e){const n=this.context;var i=!0;e.codes.length&&(i=(t.code?e.codes.indexOf(t.code.toLowerCase())>-1:!1)||(t.key?e.codes.indexOf(t.key.toLowerCase())>-1:!1));var o=!0;return e.checkMethodList.length&&(o=e.checkMethodList.every(a=>{var l=this.getCallback(a);return v(l)&&l?l.call(n,t):D(l)?!!l:!0})),i&&o}getDefaultDomElement(t){const e=this.context;let n;return t?n=e.refs[t]||e[t]||window[t]:n=e.el||e.$el||e.$root,n instanceof d?n.getElement():n}getRealEventName(t){return ui[t]||t}getCustomEventName(t){return fi[t]?t:""}getDefaultEventObject(t,e,n,i,o){var K,J;const a={eventName:this.getRealEventName(t),customEventName:this.getCustomEventName(t),callback:o},[,,...l]=i.args;a.dom=this.getDefaultDomElement(e),a.delegate=l.join(ve),a.beforeMethods=[],a.afterMethods=[],a.codes=[],a.checkMethodList=[];const c=i.getFunction("debounce"),T=i.getFunction("throttle");if(c){var g=+(((K=c.args)==null?void 0:K[0])||0);a.callback=E(o,g)}else if(T){var p=+(((J=T.args)==null?void 0:J[0])||0);a.callback=S(o,p)}const A=i.getFunctionList("after"),V=i.getFunctionList("before");return A.length&&A.forEach(F=>{var O=F.args[0].split(" "),[P,w]=O;a.afterMethods.push({target:P,param:w})}),V.length&&V.forEach(F=>{var O=F.args[0].split(" "),[P,w]=O;a.beforeMethods.push({target:P,param:w})}),i.keywords.forEach(F=>{const O=F;this.getCallback(O)?a.checkMethodList.push(O):a.codes.push(O.toLowerCase())}),a}addDomEvent(t,e,n){t.callback=this.makeCallback(t,e,n),this.addBinding(t);var i=!1;e.hasKeyword("capture")&&(i=!0),hi[t.eventName]&&(i={passive:!0,capture:i}),t.dom&&Pt.addDomEvent(t.dom,t.eventName,t.callback,i)}makeCustomEventCallback(t,e,n){var a;if(t.customEventName==="doubletab"){var i=300,o=e.getFunction("delay");return o&&(i=+(((a=o.args)==null?void 0:a[0])||0)),(...l)=>{this.doubleTab?(window.performance.now()-this.doubleTab.time<i&&n(...l),this.doubleTab=null):this.doubleTab={time:window.performance.now()}}}return n}bindingDomEvent([t,e,...n],i,o){let a=this.getDefaultEventObject(t,e,n,i,o);a.callback=this.makeCustomEventCallback(a,i,a.callback),this.addDomEvent(a,i,a.callback)}getEventNames(t){let e=[];return t.split(Tt).forEach(n=>{var i=n.split(Tt);e.push.apply(e,i)}),e}parseDomEvent(t){const e=this.context;var n=t.args;if(n){var i=this.getEventNames(n[0]),o=e[t.originalMethod].bind(e);for(let a=0,l=i.length;a<l;a++)n[0]=i[a],this.bindingDomEvent(n,t,o)}}}const Ie="on";class Ei extends j{constructor(){super(...arguments);C(this,M,[]);C(this,$,new window.WeakMap)}async initialize(){var e;((e=m(this,M))==null?void 0:e.length)&&this.context.notEventRedefine||this.parseHasEvent()}loadHasEventList(){const e=this.context.$el;if(!e)return;let n=e.$$("[has-event='true']");e.attr("has-event")==="true"&&n.unshift(e),n.length&&n.map(i=>{m(this,$).has(i.el)||m(this,$).set(i.el,{});const o=m(this,$).get(i.el);for(var a of i.attributes)if(a.nodeName.startsWith(Ie)){const l=a.nodeName.replace(Ie,"");o[l]?mt(a.nodeValue):(o[l]={applied:!1,attributeName:a.nodeName,$dom:i,eventName:l,eventHandler:mt(a.nodeValue)},m(this,M).push(o[l]))}})}parseHasEvent(){this.loadHasEventList(),m(this,M).forEach(e=>{e.applied||(e.$dom.on(e.eventName,e.eventHandler),e.applied=!0),e.$dom.removeAttr(e.attributeName),e.$dom.removeAttr("has-event")})}destroy(){b(this,M,[]),m(this,M).forEach(e=>{e.applied&&e.$dom.off(e.eventName,e.eventHandler)}),b(this,$,new window.WeakMap)}}M=new WeakMap,$=new WeakMap;class mi extends j{initialize(){var t,e;this._observers&&this.context.notEventRedefine||((!this._observers||this._observers.length===0)&&(this._observers=this.context.filterMethodes("observer")),!((t=this._bindings)!=null&&t.length)&&((e=this._observers)==null?void 0:e.length)&&this._observers.forEach(n=>this.parseObserver(n)))}destroy(){this.context.notEventRedefine||this.removeEventAll()}removeEventAll(){this.getBindings().forEach(t=>{this.disconnectObserver(t)}),this.initBindings()}disconnectObserver(t){t==null||t.disconnect()}getBindings(){return this._bindings||this.initBindings(),this._bindings}addBinding(t){this.getBindings().push(t)}initBindings(){this._bindings=[]}addObserver(t){this.addBinding(t)}getDefaultDomElement(t){const e=this.context;let n;return t?n=e.refs[t]||e[t]||window[t]:n=e.el||e.$el||e.$root,n instanceof d?n.getElement():n}createObserver(t,e){var T;const[n,i]=t.args||["intersection"],o=this.getDefaultDomElement(i),a=t.getFunction("params"),l=tt((T=a==null?void 0:a.args)==null?void 0:T[0]);let c;switch(n){case"intersection":l.root&&(l.root=this.getDefaultDomElement(l.root)),c=new window.IntersectionObserver(e,l||{}),c.observe(o);break;case"mutation":c=new window.MutationObserver(e),c.observe(o,l||{attributes:!0,characterData:!0,childList:!0});break;case"performance":c=new window.PerformanceObserver(e),c.observe(l||{entryTypes:["paint"]});break}return c}bindingObserver(t,e){this.addObserver(this.createObserver(t,e))}parseObserver(t){const e=this.context;var n=e[t.originalMethod].bind(e);this.bindingObserver(t,n)}}class pi extends j{initialize(){var t,e;this._callbacks||(this._callbacks=this.context.filterMethodes("subscribe")),!((t=this._bindings)!=null&&t.length)&&((e=this._callbacks)==null?void 0:e.length)&&this._callbacks.forEach(n=>this.parseSubscribe(n))}destroy(){this.context.notEventRedefine||(console.log("destroy store",this.context,this.context.props.ref),this.context.$store.offAll(this.context))}getCallback(t){return this.context[t]}getBindings(){return this._bindings||this.initBindings(),this._bindings}addBinding(t){this.getBindings().push(t)}initBindings(){this._bindings=[]}createLocalCallback(t,e){var n=e.bind(this.context);return n.displayName=`${this.context.sourceName}.${t}`,n.source=this.context.source,n}parseSubscribe(t){var F,O;const e=t.args.join(" "),n=[],i=[];let o=0,a=0,l=!1,c=!1,T=!1;const g=t.getFunction("debounce"),p=t.getFunction("throttle"),A=t.getFunction("allTrigger"),V=t.getFunction("selfTrigger"),K=t.getFunction("frame");g&&(o=+(((F=g.args)==null?void 0:F[0])||0)),p&&(a=+(((O=p.args)==null?void 0:O[0])||0)),A&&(l=!0),V&&(c=!0),K&&(T=!0),t.keywords.forEach(P=>{const w=P;this.context[w]?n.push(w):i.push(w)});const J=this.context[t.originalMethod];[...i,e].filter(Boolean).forEach(P=>{var w=this.createLocalCallback(P,J);this.context.$store.on(P,w,this.context,o,a,l,c,n,T)}),this.addBinding(t)}}const Y="ref",ke=d.create("div"),Bt=`[${Y}]`,Ut="refclass",Ti=`[${Ut}]`,Me=[],Gt=class extends an{constructor(e,n){super();C(this,At);C(this,ot);C(this,Nt);C(this,y,{});C(this,vt,{});C(this,nt,0);C(this,q,void 0);C(this,st,void 0);C(this,X,void 0);C(this,H,{});C(this,_,{});C(this,it,!1);C(this,rt,[]);C(this,Z,{});C(this,at,0);Wt(this,"useMounted",e=>this.createFunction("mounted",e));Wt(this,"useDestroyed",e=>this.createFunction("destroyed",e));this.refs={},this.children={},this.id=Lt(),this.initializeProperty(e,n),this.initComponents()}initializeHandler(){return super.initializeHandler({BindHandler:li,CallbackHandler:ci,NativeEventHandler:Ei,DomEventHandler:gi,ObserverHandler:mi,StoreHandler:pi})}get __timestamp(){return m(this,nt)}get timestamp(){return m(this,st)}set timestamp(e){b(this,st,e)}get target(){return this.$el.el}checkProps(e={}){return e}initializeProperty(e,n={}){this.opt=e||{},this.parent=this.opt,this.source=Lt(),this.sourceName=this.constructor.name,this.props=new Proxy(m(this,H),{get:(i,o)=>lt(this,Nt,$e).call(this,o),set:(i,o)=>{throw new Error(`${o} is readonly`)}}),lt(this,ot,jt).call(this,n)}hasProp(e){return m(this,rt).includes(e==null?void 0:e.toUpperCase())}setServer(e=!0){b(this,it,e)}get isServer(){var e;return((e=this.parent)==null?void 0:e.isServer)||m(this,it)}initComponents(){this.childComponents=this.components()}createFunction(e,n){return v(n)&&!m(this,Z)[e]&&(m(this,Z)[e]=n),m(this,Z)[e]}runFunction(e,n){const i=this.createFunction(e,n);if(!(i!=null&&i.running))return v(i)&&(i.running||(i.running=!0,i.call(this))),i}initState(){return{}}setState(e={},n=!0){b(this,vt,m(this,y)),b(this,y,Object.assign({},m(this,y),e)),n&&this.refresh()}toggleState(e,n=!0){this.setState({[e]:!m(this,y)[e]},n)}apply(e){return le(e)}changedProps(e){const n=m(this,H);return!St(n,e,0,{content:!0,contentChildren:!0})}_reload(e){this.changedProps(e)&&(lt(this,ot,jt).call(this,e),b(this,y,{}),this.setState(this.initState()))}checkLoad(e){window.requestAnimationFrame(()=>{this.render(e)})}get state(){return m(this,y)}get propKeys(){return m(this,_)}get ref(){return this.props.ref}get isPreLoaded(){return!0}async render(e){if(!this.isPreLoaded){this.checkLoad(e);return}const n=this.template();let i=this.parseMainTemplate(n,!!this.$el);return this.$el?this.$el.htmlDiff(i,{checkRefClass:(o,a)=>{const l=d.create(a),c=this._getComponentInfo(l);if(this.children[c.refName]){const g=this.children[c.refName];return g.timestamp=this.__timestamp,g._reload(c.props),!1}const T=Object.keys(this.children).find(g=>{var p;return(p=this.children[g].$el)==null?void 0:p.is(o)});if(T){const g=this.children[T];if(g.sourceName===c.refClass)return g.timestamp=this.__timestamp,g._reload(c.props),!1}return!1}}):(this.$el=i,this.refs.$el=this.$el,e&&e.hasChild(this.$el)===!1&&(e.append(this.$el),this.onMounted())),await this.load(),m(this,at)===0&&(b(this,at,1),this.afterRender()),this}get html(){return this.$el.outerHTML()}initialize(){b(this,y,this.initState())}afterRender(){}components(){return yt({},this.parent.childComponents)}getRef(...e){const n=e.join("");return this.refs[n]}refreshElementReference(e,n){for(var i=e.$$(Bt),o=0,a=i.length;o<a;o++){const l=i[o],c=l.attr(Y);this.refs[c]?this.refs[c].is(l)===!1&&(this.refs[c]=l):this.refs[c]=l}this.afterLoadRendering(e,n)}afterLoadRendering(){}afterComponentRendering(){}parseLoadTemplate(e){let n=d.makeElementList(e);for(var i=0,o=n.length;i<o;i++)for(var a=n[i].$$(Bt),l={},c=0,T=a.length;c<T;c++){const A=a[c].attr(Y);l[A]?console.warn(`${A} is duplicated. - ${this.sourceName}`,this):l[A]=!0}return ke.append(n),ke.createChildrenFragment()}parseMainTemplate(e){let n=d.makeElementList(e);for(var i=0,o=n.length;i<o;i++){const g=n[i];var a=g.attr(Y);a&&(this.refs[a]||(this.refs[a]=g));for(var l=g.$$(Bt),c=0,T=l.length;c<T;c++){const p=l[c],A=p.attr(Y);this.refs[A]||(this.refs[A]=p)}}return n[0]}parsePropertyInfo(e){let n={};for(var i of e.attributes){const a=i.name||i.nodeName,l=i.value||i.nodeValue;if(oe(a)){const c=tt(a);U(c)?n=Object.assign(n,c):n[a]=tt(l)}else n[a]=tt(l)}const o=e.html();return o&&(n.content=o,n.contentChildren=this.parseContent(n.content)),n}parseSourceName(e){return e.parent?[e.sourceName,...this.parseSourceName(e.parent)]:[e.sourceName]}getEventMachineComponent(e){var n=fe(e)||this.childComponents[e];return n}createFunctionComponent(e,n,i=Gt){class o extends i{template(){return e.call(this,this.props)}}return new o(this,n)}createInstanceForComponent(e,n,i){return e.__proto__.name==="ProxyComponent"?new e({target:n,props:i}):e.__proto__.name===""&&v(e)?this.createFunctionComponent(e,i):new e(this,i)}appendTo(){var e;(e=this.$el)==null||e.appendTo(this.renderTarget),this.onMounted()}async renderComponent({$dom:e,refName:n,component:i,props:o}){var a=null;this.children[n]?(a=this.children[n],a.timestamp=this.__timestamp,a._reload(o)):(a=this.createInstanceForComponent(i,e.$parent.el,o),a.timestamp=this.__timestamp,this.children[n||a.id]=a,v(a.render)&&await a.render()),this.afterComponentRendering(e,n,a,o),a.renderTarget?(a.appendTo(),e.remove()):a.$el?e.replace(a.$el):e.remove()}parseContent(e,n=[]){return d.create("div").html(e).children().map(i=>this._getComponentInfo(i)).filter(i=>n.length===0?!0:n.includes(i.refClass))}_getComponentInfo(e){const n=e.attr(Ut),i=this.getEventMachineComponent(n);if(i){let o=this.parsePropertyInfo(e),a=e.attr(Y);return{$dom:e,refClass:n,props:o,refName:a||o.ref,component:i}}else return{refClass:n,notUsed:!0,$dom:e}}getComponentInfoList(e){if(!e)return Me;let n=e.$$(Ti).filter(i=>i.path().filter(o=>o.attr(Ut)).length===1);return n.length?n.map(i=>this._getComponentInfo(i)):Me}async parseComponent(){const e=this.$el,n=this.getComponentInfoList(e);!n.length||(await Promise.all(n.map(async i=>{i.notUsed?(i.$dom.remove(),console.warn(`${i.refClass} is not used.`)):await this.renderComponent(i)})),Ot(this.children,(i,o)=>{o.timestamp!==this.__timestamp&&o.clean()}))}clean(){if(this.$el&&!this.$el.hasParent())return Ot(this.children,(e,n)=>{v(n==null?void 0:n.clean)&&n.clean()}),this.destroy(),!0}refresh(){this.render()}async _afterLoad(){lt(this,At,Ue).call(this),this.runHandlers("initialize"),await this.bindData(),await this.parseComponent()}async makeLoadAction(e){const[n,...i]=e.args;let o=e.hasKeyword("domdiff");const a=this.refs[n];if(a){const l=await e.execute(...i),c=this.parseLoadTemplate(l);o?a.htmlDiff(c):a.html(c),this.refreshElementReference(a,n)}}async load(...e){m(this,q)||b(this,q,this.filterMethodes("load"));const n=m(this,q).filter(i=>e.length===0?!0:i.args[0]===e[0]);n.length&&await Promise.all(n.map(async i=>{await this.makeLoadAction(i)})),await this._afterLoad()}async bindData(...e){await this.runHandlers("bindData",...e)}template(){return null}eachChildren(e){!v(e)||Object.keys(this.children).forEach(n=>{e(this.children[n])})}hmr(){this.created(),this.initialize(),this.refresh(),this.eachChildren(e=>{e.hmr()})}destroy(){this.eachChildren(e=>{e.destroy()}),this.runHandlers("destroy"),this.$el&&this.$el.remove(),this.$el=null,this.refs={},this.children={},this.onDestroyed()}collectMethodes(e=!1){return(!m(this,X)||e)&&b(this,X,u(this,n=>R.check(n)).map(n=>R.parse(n,this))),m(this,X)}filterMethodes(e,n=!1){return this.collectMethodes(n).filter(i=>i.method===e)}findChildren(e){return this.props.contentChildren.filter(n=>n.component===e)}findChildByRef(e){const n=[];return Object.keys(this.children).forEach(i=>{const o=this.children[i];o.ref===e&&n.push(o),Object.keys(o.children).length&&n.push(...o.findChildByRef(e))}),n}findRef(e){const n=[];return Object.keys(this.children).forEach(i=>{const o=this.children[i];if(e(o)&&n.push(o),n.length||(o.children&&n.push(...o.findNestedChildren(e)),n.length))return n}),n}getChildContent(e,n=""){var i;return((i=this.getChild(e))==null?void 0:i.props.content)||n}getChild(e){return this.props.contentChildren.find(e)}onMounted(){const e=this.createFunction("mounted");e&&e()}onDestroyed(){const e=this.createFunction("destroyed");e&&e()}};let $t=Gt;y=new WeakMap,vt=new WeakMap,nt=new WeakMap,q=new WeakMap,st=new WeakMap,X=new WeakMap,H=new WeakMap,_=new WeakMap,it=new WeakMap,rt=new WeakMap,Z=new WeakMap,at=new WeakMap,At=new WeakSet,Ue=function(){Be(this,nt)._++},ot=new WeakSet,jt=function(e){b(this,H,this.checkProps(e)),b(this,_,{}),Object.keys(e).forEach(n=>{m(this,_)[n.toUpperCase()]=n}),b(this,rt,Object.keys(m(this,_)))},Nt=new WeakSet,$e=function(e){return m(this,H)[m(this,_)[e.toUpperCase()]]};const Rt=class extends $t{constructor(e,n={}){super(e,n);C(this,G,void 0);n.store?b(this,G,n.store):this.parent.$store||b(this,G,new me),this.created(),this.initialize()}currentContext(){return this.contexts[this.contexts.length-1]}setStore(e){b(this,G,e)}get $store(){return m(this,G)||this.parent.$store}async created(){}createLocalCallback(e,n){var i=n.bind(this);return i.displayName=`${this.sourceName}.${e}`,i.source=this.source,i}emit(e,...n){this.$store.source=this.source,this.$store.sourceContext=this,this.$store.emit(e,...n)}nextTick(e,n=0){window.setTimeout(()=>{this.$store.nextTick(e)},n)}trigger(e,...n){this.$store.source=this.source,this.$store.trigger(e,...n)}broadcast(e,...n){Object.keys(this.children).forEach(i=>{this.children[i].trigger(e,...n),this.children[i].broadcast(e,...n)})}on(e,n,i=0,o=0,a=!1,l=!1,c=!1){this.$store.on(e,n,this.source,i,o,a,l,[],c)}off(e,n){this.$store.off(e,n,this.source)}subscribe(e,n=0,i=0){const o=`subscribe.${dt()}`,a=this.createLocalCallback(o,e);return this.$store.on(o,a,this,n,i,!1,!0),o}createFunctionComponent(e,n,i=Rt){return super.createFunctionComponent(e,n,i)}static createElementInstance(e,n){if(e.__proto__.name===""){class i extends Rt{template(){return e.call(this,this.props)}}return new i(n,n)}else return new e(n,n)}};let et=Rt;G=new WeakMap;const Ci=(s,t={})=>{const e=d.create(t.container||document.body),n=et.createElementInstance(s,t);return n.render(e),de(n),n};async function bi(s,t){const e=et.createElementInstance(s,t);return e.setServer(!0),(await e.render()).html}const vi={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,width:!0,height:!0,top:!0,left:!0,right:!0,bottom:!0,border:!0,padding:!0,margin:!0,paddingLeft:!0,paddingRight:!0,paddingTop:!0,paddingBottom:!0,marginLeft:!0,marginRight:!0,marginTop:!0,marginBottom:!0,gap:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ht={},Ai=/([A-Z])/g,Ni=s=>{if(Ht[s])return Ht[s];const t=s.replace(Ai,"-$1").toLowerCase();return Ht[s]=t,t};function Ri(s,t){return typeof t=="number"&&vi[s]&&(t=t+"px"),t}function yi(s){return Ni(s)}function Oi(s,t=""){var e=s||{};return Object.keys(e).filter(n=>D(e[n])).map(n=>`${yi(n)}: ${Ri(n,e[n])}`).join(";"+t)}function Si(s){return Object.keys(s||{}).map(e=>e==="class"&&U(s[e])?`${e}="${Q(s[e])}"`:e==="style"&&U(s[e])?`${e}="${Oi(s[e])}"`:Zt(s[e])||W(s[e])||s[e]==="undefined"?s[e]?e:"":`${e}="${s[e]}"`).join(" ")}function bt(s,t={},e=[]){e=e.flat(1/0).join("");let n;n=Object.keys(t).length?x(t):"";const i=t.ref?`ref="${t.ref}"`:"";return`<object refClass="${s}" ${i} ${n}>${e}</object>`}function _e(...s){return s.map(t=>{let e,n={},i=[];return B(t)?e=t:L(t)&&([e,n={},i=[]]=t),i.length?bt(e,n,_e(i)):bt(e,n)}).join(`
`)}function Fe(s,t,e=[]){e=e.flat(1/0);let n=!1;return Object.keys(t).forEach(i=>{if(i.startsWith("on")){const o=x(t[i]);t[i]=o,n=!0}}),`<${s} ${Si(Kt(yt({},t),{"has-event":n?"true":void 0}))}>${e.join(" ")}</${s}>`}function wi(s,t={},...e){if(e=e.flat(1/0),s===Pe)return e;if(t=t||{},typeof s!="string"){const n=s.name;return ce({[n]:s}),bt(n,t,e)}else return Fe(s,t,e)}const Pe=new Object;r.AFTER=Ft,r.ALL_TRIGGER=Re,r.ALT=Ln,r.ANIMATIONEND=js,r.ANIMATIONITERATION=Ys,r.ANIMATIONSTART=zs,r.ARROW_DOWN=pn,r.ARROW_LEFT=Tn,r.ARROW_RIGHT=Cn,r.ARROW_UP=mn,r.BACKSPACE=Nn,r.BEFORE=dn,r.BIND=ii,r.BIND_CHECK_DEFAULT_FUNCTION=we,r.BIND_CHECK_FUNCTION=Se,r.BLUR=ks,r.BRACKET_LEFT=wn,r.BRACKET_RIGHT=Sn,r.BaseStore=me,r.CALLBACK=Oe,r.CAPTURE=jn,r.CHANGE=Os,r.CHANGEINPUT=Ks,r.CHECKER=f,r.CLICK=es,r.COMMAND=ln,r.CONFIG=Qn,r.CONTEXTMENU=ys,r.CONTROL=Mn,r.CUSTOM=N,r.D1000=Vn,r.DEBOUNCE=Ne,r.DELAY=Gn,r.DELETE=Rn,r.DOMDIFF=Hn,r.DOUBLECLICK=ns,r.DOUBLETAB=Qs,r.DRAG=ms,r.DRAGEND=Rs,r.DRAGENTER=bs,r.DRAGEXIT=As,r.DRAGLEAVE=vs,r.DRAGOUT=Ns,r.DRAGOVER=Cs,r.DRAGSTART=ps,r.DROP=Ts,r.Dom=d,r.DomDiff=ft,r.ENTER=bn,r.EQUAL=yn,r.ESCAPE=An,r.EVENT=_t,r.FIT=Un,r.FOCUS=ws,r.FOCUSIN=Ls,r.FOCUSOUT=Is,r.FRAME=Wn,r.FUNC_END_CHARACTER=Te,r.FUNC_REGEXP=pe,r.FUNC_START_CHARACTER=Mt,r.FragmentInstance=Pe,r.HASHCHANGE=ei,r.IF=gn,r.INPUT=Ss,r.KEY=En,r.KEYDOWN=ds,r.KEYPRESS=Es,r.KEYUP=gs,r.LEFT_BUTTON=Ae,r.LOAD=ni,r.MAGIC_METHOD=kt,r.MAGIC_METHOD_REG=It,r.META=kn,r.MINUS=On,r.MOUSE=_n,r.MOUSEDOWN=ss,r.MOUSEENTER=ls,r.MOUSELEAVE=cs,r.MOUSEMOVE=rs,r.MOUSEOUT=os,r.MOUSEOVER=as,r.MOUSEUP=is,r.MagicMethod=R,r.NAME_SAPARATOR=Tt,r.OBSERVER=ts,r.ON=cn,r.ORIENTATIONCHANGE=ti,r.PARAMS=zn,r.PASSIVE=$n,r.PASTE=Ms,r.PEN=Pn,r.PIPE=be,r.POINTEREND=Vs,r.POINTERENTER=Us,r.POINTERLEAVE=Hs,r.POINTERMOVE=Gs,r.POINTEROUT=$s,r.POINTEROVER=Bs,r.POINTERSTART=Ds,r.POPSTATE=xs,r.PREVENT=Yn,r.RAF=xn,r.RESIZE=_s,r.RIGHT_BUTTON=Bn,r.SAPARATOR=ve,r.SCROLL=Fs,r.SELF=Dn,r.SELF_TRIGGER=ye,r.SHIFT=In,r.SPACE=vn,r.SPLITTER=k,r.STOP=qn,r.SUBMIT=Ps,r.SUBSCRIBE=Xn,r.SUBSCRIBE_ALL=Zn,r.SUBSCRIBE_SELF=Jn,r.THROTTLE=Kn,r.TOUCH=Fn,r.TOUCHEND=fs,r.TOUCHMOVE=us,r.TOUCHSTART=hs,r.TRANSITIONCANCEL=Js,r.TRANSITIONEND=Xs,r.TRANSITIONRUN=Zs,r.TRANSITIONSTART=qs,r.UIElement=et,r.VARIABLE_SAPARATOR=ae,r.WHEEL=Ws,r.classnames=Q,r.clone=ze,r.collectProps=u,r.combineKeyArray=je,r.createComponent=bt,r.createComponentList=_e,r.createElement=Fe,r.createElementJsx=wi,r.createHandlerInstance=Ee,r.debounce=E,r.defaultValue=Xt,r.get=Ge,r.getRef=si,r.getRootElementInstanceList=ge,r.getVariable=tt,r.hasVariable=oe,r.ifCheck=ct,r.initializeGroupVariables=tn,r.isArray=L,r.isBoolean=Zt,r.isEqual=St,r.isFunction=v,r.isNotString=Ve,r.isNotUndefined=D,r.isNotZero=Ke,r.isNumber=wt,r.isObject=U,r.isString=B,r.isUndefined=W,r.isZero=Jt,r.keyEach=Ot,r.keyMap=qt,r.keyMapJoin=He,r.makeEventChecker=Ce,r.makeRequestAnimationFrame=Yt,r.normalizeWheelEvent=ri,r.recoverVariable=mt,r.registAlias=en,r.registElement=ce,r.registHandler=sn,r.registRootElementInstance=de,r.renderRootElementInstance=nn,r.renderToString=bi,r.replaceElement=he,r.retriveAlias=ue,r.retriveElement=fe,r.retriveHandler=rn,r.spreadVariable=le,r.start=Ci,r.throttle=S,r.uuid=Lt,r.uuidShort=dt,r.variable=x,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
