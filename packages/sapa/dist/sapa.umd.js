var ui=Object.defineProperty,fi=Object.defineProperties;var di=Object.getOwnPropertyDescriptors;var Ne=Object.getOwnPropertySymbols;var gi=Object.prototype.hasOwnProperty,Ei=Object.prototype.propertyIsEnumerable;var Oe=(i,f,g)=>f in i?ui(i,f,{enumerable:!0,configurable:!0,writable:!0,value:g}):i[f]=g,Mt=(i,f)=>{for(var g in f||(f={}))gi.call(f,g)&&Oe(i,g,f[g]);if(Ne)for(var g of Ne(f))Ei.call(f,g)&&Oe(i,g,f[g]);return i},ye=(i,f)=>fi(i,di(f));var _t=(i,f,g)=>{if(!f.has(i))throw TypeError("Cannot "+g)};var C=(i,f,g)=>(_t(i,f,"read from private field"),g?g.call(i):f.get(i)),b=(i,f,g)=>{if(f.has(i))throw TypeError("Cannot add the same private member more than once");f instanceof WeakSet?f.add(i):f.set(i,g)},p=(i,f,g,w)=>(_t(i,f,"write to private field"),w?w.call(i,g):f.set(i,g),g),Se=(i,f,g,w)=>({set _(it){p(i,f,it,g)},get _(){return C(i,f,w)}}),st=(i,f,g)=>(_t(i,f,"access private method"),g);(function(i,f){typeof exports=="object"&&typeof module!="undefined"?f(exports):typeof define=="function"&&define.amd?define(["exports"],f):(i=typeof globalThis!="undefined"?globalThis:i||self,f(i.sapa={}))})(this,function(i){var y,Et,J,G,Q,V,K,M,tt,et,mt,we,nt,Pt,Tt,Le,D;"use strict";function f(s,t=()=>!0){let e=s,n=[];do{if(e instanceof Object===!1)break;const a=Object.getOwnPropertyNames(e).filter(t);n.push.apply(n,a)}while(e=Object.getPrototypeOf(e));return n}function g(s,t=0){if(t===0)return s;var e=void 0;return function(n,r,a,o,l){e&&window.clearTimeout(e),e=window.setTimeout(function(){s(n,r,a,o,l)},t||300)}}function w(s,t){var e=void 0;return function(n,r,a,o,l){e||(e=window.setTimeout(function(){s(n,r,a,o,l),e=null},t||300))}}function it(s,t,e){return(...n)=>{e.every(a=>t[a].apply(t,n))&&s.apply(t,n)}}function Ft(s,t){return(...e)=>{window.requestAnimationFrame(()=>{s.apply(t,e)})}}function pt(s,t){Object.keys(s).forEach((e,n)=>{t(e,s[e],n)})}function Dt(s,t){return Object.keys(s).map((e,n)=>t(e,s[e],n))}function Ie(s,t,e=""){return Dt(s,t).join(e)}function ke(s,t,e){var n=Bt(s[t],t);return v(e)?e(n):n}function Bt(s,t){return typeof s=="undefined"?t:s}function rt(s){return typeof s=="undefined"}function U(s){return!rt(s)}function Ut(s){return typeof s=="boolean"}function F(s){return typeof s=="string"}function Me(s){return!F(s)}function $(s){return Array.isArray(s)}function z(s){return typeof s=="object"&&!Array.isArray(s)&&!bt(s)&&!F(s)&&s!==null}function v(s){return typeof s=="function"}function bt(s){return typeof s=="number"}function $t(s){return s===0}function _e(s){return!$t(s)}const Pe=s=>JSON.parse(JSON.stringify(s));function Fe(s){if(!rt(s))return Pe(s)}function De(s){return Object.keys(s).forEach(t=>{Array.isArray(s[t])&&(s[t]=s[t].join(", "))}),s}function Y(...s){const t=[];return s.filter(Boolean).forEach(e=>{$(e)?t.push(Y(...e)):z(e)?Object.keys(e).filter(n=>Boolean(e[n])).forEach(n=>{t.push(n)}):F(e)&&t.push(e)}),t.join(" ")}const Be=(s,t,e)=>{e?(s.setAttribute(t,t),s[t]=e):(s.removeAttribute(t),s[t]=e)},Ue=(s,t,e)=>{typeof e=="boolean"?Be(s,t,e):s.setAttribute(t,e)},$e=(s,t)=>{s.removeAttribute(t),s[t]=!1},He=(s,t)=>{s.removeAttribute(t)},Ge=(s,t,e)=>{typeof e=="boolean"?$e(s,t):t&&He(s,t)},Ve=(s,t,e,n)=>{e?(!n||e!==n)&&Ue(s,t,e):Ge(s,t,n)},Ke=(s,t={},e={})=>{const n=[];n.push.apply(n,Object.keys(t)),n.push.apply(n,Object.keys(e)),new Set(n).forEach(a=>{Ve(s,a,t[a],e[a])})};function We(s,t){return s.nodeType===window.Node.TEXT_NODE&&s.textContent!==t.textContent||s.nodeName!==t.nodeName}function Ht(s){return(s==null?void 0:s.nodeType)===8?!0:s.nodeType!==window.Node.TEXT_NODE&&s.getAttribute("data-domdiff-pass")==="true"}function ze(s){return s.nodeType!==window.Node.TEXT_NODE&&s.getAttribute("refClass")}function Gt(s){var t={};const e=s.length;for(let n=0;n<e;n++){const r=s[n];t[r.name]=r.value}return t}function Ye(s,t){return s.nodeType==window.Node.TEXT_NODE||t.nodeType===window.Node.TEXT_NODE?!1:s.outerHTML==t.outerHTML}function Vt(s,t,e,n,r={}){if(!t)s.appendChild(e.cloneNode(!0));else if(!e)s.removeChild(t);else if(!(Ht(t)||Ht(e))){if(Ye(e,t))return;if(We(e,t)||ze(e))t.replaceWidth(e.cloneNode(!0));else if(e.nodeType!==window.Node.TEXT_NODE&&e.nodeType!==window.Node.COMMENT_NODE&&e.toString()!=="[object HTMLUnknownElement]"){r.checkPassed&&r.checkPassed(t,e)||Ke(t,Gt(e.attributes),Gt(t.attributes));for(var a=at(t),o=at(e),l=Math.max(a.length,o.length),h=0;h<l;h++)Vt(t,a[h],o[h],h,r)}}}const at=s=>{var t=s.firstChild;if(!t)return[];var e=[];do e.push(t),t=t.nextSibling;while(t);return e},je={checkPassed:void 0,keyField:"key",removedElements:[]};function ot(s,t,e={}){e=ye(Mt({},je),{checkPassed:v(e.checkPassed)?e.checkPassed:void 0}),s=s.el||s,t=t.el||t;var n=at(s),r=at(t),a=Math.max(n.length,r.length);if(a!==0)if(n.length===0&&r.length>0)s.append(...r);else if(n.length>0&&r.length===0)s.textContent="";else for(var o=0;o<a;o++)Vt(s,n[o],r[o],o,e)}const Kt=/[xy]/g;function vt(){var s=new Date().getTime(),t="xxx12-xx-34xx".replace(Kt,function(e){var n=(s+Math.random()*16)%16|0;return s=Math.floor(s/16),(e=="x"?n:n&3|8).toString(16)});return t}function lt(){var s=new Date().getTime(),t="idxxxxxxx".replace(Kt,function(e){var n=(s+Math.random()*16)%16|0;return s=Math.floor(s/16),(e=="x"?n:n&3|8).toString(16)});return t}const ct={},j={},Wt={},zt=new Set,I=new Map,H=new Map,Yt="v:";function ht(s,t=""){const e=`${Yt}${lt()}`;return I.set(e,s),t&&(H.has(t)||H.set(t,new Set),H.get(t).add(e)),e}function Xe(s){H.has(s)&&(H.get(s).forEach(t=>{I.delete(t)}),H.delete(s))}function jt(s,t=!0){if(F(s)===!1)return s;let e=s;return I.has(s)&&(e=I.get(s),t&&I.delete(s)),e}function X(s){return I.has(s)?I.get(s):s}function Xt(s){return I.has(s)}function qt(s){return Object.entries(s).map(([t,e])=>`${t}=${ht(e)}`).join(" ")}function xt(s={}){Object.keys(s).forEach(t=>{ct[t]=s[t]})}function Zt(s){ct[s.name]&&(ct[s.name]=s)}function qe(s,t){Wt[s]=t}function Jt(s){return Wt[s]}function Qt(s){return ct[Jt(s)||s]}function te(s){zt.add(s)}function ee(){return[...zt]}function xe(s){Zt(s),ee().forEach(t=>{t.hmr()})}function ne(s){Object.keys(s).forEach(t=>{j[t]=s[t]})}function Ze(s){return j[s]}function se(s){return Object.keys(j).filter(t=>Boolean(j[t])).map(t=>{const e=j[t];return new e(s)})}class d{constructor(t,e,n){if(typeof t!="string")t instanceof d?this.el=t.el:this.el=t;else{var r=document.createElement(t);e&&(r.className=e),n=n||{},Object.assign(r,n),this.el=r}}static create(t,e,n){return new d(t,e,n)}static createByHTML(t){var e=d.create("div");return e.html(t).firstChild}static makeElementList(t){const e=d.create("div");let n=[];$(t)||(t=[t]),t=t.filter(Boolean);for(let r=0,a=t.length;r<a;r++){const o=t[r];F(o)?n.push(...e.html(o==null?void 0:o.trim()).childNodes||[]):o&&n.push(d.create(o))}return n}static getScrollTop(){return Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop)}static getScrollLeft(){return Math.max(window.pageXOffset,document.documentElement.scrollLeft,document.body.scrollLeft)}static parse(t){var e=window.DOMParser();return e.parseFromString(t,"text/htmll")}static body(){return d.create(document.body)}get exists(){return Boolean(this.el)}setAttr(t){return Object.keys(t).forEach(e=>{this.attr(e,t[e])}),this}setAttrNS(t,e="http://www.w3.org/2000/svg"){return Object.keys(t).forEach(n=>{this.attr(n,t[n],e)}),this}setProp(t){return Object.keys(t).forEach(e=>{this.el[e]!=t[e]&&(this.el[e]=t[e])}),this}data(t,e){if(arguments.length===1){const n=this.attr("data-"+t);return jt(n,!1)}else if(arguments.length===2)return this.attr("data-"+t,e);return this}attr(...t){return t.length==1?v(this.el.getAttribute)&&this.el.getAttribute(t[0]):(this.el.getAttribute(t[0])!=t[1]&&this.el.setAttribute(t[0],t[1]),this)}attrNS(t,e,n="http://www.w3.org/2000/svg"){return arguments.length==1?this.el.getAttributeNS(n,t):(this.el.getAttributeNS(n,t)!=e&&this.el.setAttributeNS(n,t,e),this)}attrKeyValue(t){return{[this.el.getAttribute(t)]:this.val()}}get attributes(){try{return[...this.el.attributes],this.el.attributes}catch{const n=this.el.attributes.length,r=[];for(var t=0;t<n;t++)r.push(this.el.attributes[`${t}`]);return r}}attrs(...t){return t.map(e=>this.el.getAttribute(e))}styles(...t){return t.map(e=>this.el.style[e])}removeAttr(t){return this.el.removeAttribute(t),this}removeStyle(t){return this.el.style.removeProperty(t),this}is(t){return t instanceof d?this.el===t.el:this.el===t}isTag(t){return this.el.tagName.toLowerCase()===t.toLowerCase()}closest(t){for(var e=this,n=!1;!(n=e.hasClass(t));)if(e.el.parentNode)e=d.create(e.el.parentNode);else return null;return n?e:null}path(){if(!this.el)return[];let t=[this],e=this.parent();if(!e.el)return t;for(;e&&(t.unshift(e),e=e.parent(),!!e.el););return t}get $parent(){return this.parent()}parent(){return d.create(this.el.parentNode)}hasParent(){return!!this.el.parentNode}removeClass(...t){return this.el.classList.remove(...t),this}updateClass(t){return this.el.className=t,this}replaceClass(t,e){return this.el.classList.replace(t,e),this}hasClass(t){return this.el.classList?this.el.classList.contains(t):!1}addClass(...t){return this.el.classList.add(...t),this}onlyOneClass(t){var e=this.parent();e.children().forEach(n=>{n.removeClass(t)}),this.addClass(t)}toggleClass(t,e){return this.el.classList.toggle(t,e),this}outerHTML(){return this.isTextNode?this.text():this.el.outerHTML}html(t){try{return typeof t=="undefined"?this.el.innerHTML:(typeof t=="string"?Object.assign(this.el,{innerHTML:t}):this.empty().append(t),this)}catch(e){return console.log(e,t),this}}htmlDiff(t){ot(this,t)}updateDiff(t,e="div",n={}){ot(this,d.create(e).html(t),n)}updateSVGDiff(t,e="div"){ot(this,d.create(e).html(`<svg>${t}</svg>`).firstChild.firstChild)}getById(t){return this.el.getElementById(t)}find(t){if(!this.isTextNode)return this.el.querySelector(t)}$(t){var e=this.find(t);return e?d.create(e):null}findAll(t){return this.isTextNode?[]:Array.from(this.el.querySelectorAll(t))}$$(t){var e=this.findAll(t);return e.map(n=>d.create(n))}empty(){for(;this.el.firstChild;)this.el.removeChild(this.el.firstChild);return this}append(t){return t?($(t)?this.el.append(...t.map(e=>e.el||e)):typeof t=="string"?this.el.appendChild(document.createTextNode(t)):this.el.appendChild(t.el||t),this):this}prepend(t){return typeof t=="string"?this.el.prepend(document.createTextNode(t)):this.el.prepend(t.el||t),this}prependHTML(t){var e=d.create("div").html(t);return this.prepend(e.createChildrenFragment()),e}appendHTML(t){var e=d.create("div").html(t);return this.append(e.createChildrenFragment()),e}createChildrenFragment(){const t=this.childNodes;var e=document.createDocumentFragment();return t.forEach(n=>e.appendChild(n.el)),e}appendTo(t){var e=t.el?t.el:t;return e.appendChild(this.el),this}remove(){return this.el.parentNode&&this.el.parentNode.removeChild(this.el),this}removeChild(t){return this.el.removeChild(t.el||t),this}text(t){if(typeof t=="undefined")return this.el.textContent;var e=t;return t instanceof d&&(e=t.text()),this.el.textContent!==e&&(this.el.textContent=e),this}css(t,e){if(typeof t!="undefined"&&typeof e!="undefined")t.indexOf("--")===0&&typeof e!="undefined"?this.el.style.setProperty(t,e):this.el.style[t]=e;else if(typeof t!="undefined"){if(typeof t=="string")return window.getComputedStyle(this.el)[t];Object.entries(t).forEach(([n,r])=>{n.indexOf("--")===0&&typeof r!="undefined"?this.el.style.setProperty(n,r):this.el.style[n]=r})}return this}getComputedStyle(...t){var e=window.getComputedStyle(this.el),n={};return t.forEach(r=>{n[r]=e[r]}),n}getStyleList(...t){for(var e={},n=this.el.style.length,r=0;r<n;r++){var a=this.el.style[r];e[a]=this.el.style[a]}return t.forEach(o=>{e[o]=this.css(o)}),e}cssText(t){return typeof t=="undefined"?this.el.style.cssText:(t!=this.el.tempCssText&&(this.el.style.cssText=t,this.el.tempCssText=t),this)}cssArray(t){return t[0]&&(this.el.style[t[0]]=t[1]),t[2]&&(this.el.style[t[2]]=t[3]),t[4]&&(this.el.style[t[4]]=t[5]),t[6]&&(this.el.style[t[6]]=t[7]),t[8]&&(this.el.style[t[8]]=t[9]),this}cssFloat(t){return parseFloat(this.css(t))}cssInt(t){return parseInt(this.css(t))}px(t,e){return this.css(t,`${e}px`)}rect(){return this.el.getBoundingClientRect()}bbox(){return this.el.getBBox()}isSVG(){return this.el._cachedIsSVG||(this.el._cachedIsSVG={value:this.el.tagName.toLowerCase()==="svg"}),this.el._cachedIsSVG.value}offsetRect(){if(this.isSVG()){const e=this.parent().rect(),n=this.rect();return{x:n.x-e.x,y:n.y-e.y,width:n.width,height:n.height}}const t=this.el;return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight}}offsetClientRect(){if(this.isSVG()){const n=this.parent().rect(),r=this.rect();return{x:r.x-n.x,y:r.y-n.y,width:r.width,height:r.height}}const t=this.parent().rect(),e=this.rect();return{x:e.x-t.x,y:e.y-t.y,width:e.width,height:e.height}}offset(){var t=this.rect(),e=d.getScrollTop(),n=d.getScrollLeft();return{top:t.top+e,left:t.left+n}}offsetLeft(){return this.offset().left}offsetTop(){return this.offset().top}position(){return this.el.style.top?{top:parseFloat(this.css("top")),left:parseFloat(this.css("left"))}:this.rect()}size(){return[this.width(),this.height()]}width(){return this.el.offsetWidth||this.rect().width}contentWidth(){return this.width()-this.cssFloat("padding-left")-this.cssFloat("padding-right")}height(){return this.el.offsetHeight||this.rect().height}contentHeight(){return this.height()-this.cssFloat("padding-top")-this.cssFloat("padding-bottom")}val(t){if(typeof t=="undefined")return this.el.value;if(typeof t!="undefined"){var e=t;t instanceof d&&(e=t.val()),this.el.value=e}return this}matches(t){return this.el&&this.el.matches?this.el.matches(t)?this:this.parent().matches(t):null}get value(){return this.el.value}get naturalWidth(){return this.el.naturalWidth}get naturalHeight(){return this.el.naturalHeight}get files(){return this.el.files?[...this.el.files]:[]}get isTextNode(){return this.el.nodeType===3}realVal(){switch(this.el.nodeType){case"INPUT":var t=this.attr("type");return t=="checkbox"||t=="radio"?this.checked():this.el.value;case"SELECT":case"TEXTAREA":return this.el.value}return""}int(){return parseInt(this.val(),10)}float(){return parseFloat(this.val())}show(t="block"){return this.el.style.display=t!="none"?t:"block",this}hide(){return this.el.style.display="none",this}isHide(){return this.el.style.display==="none"}isShow(){return!this.isHide()}toggle(t){var e=this.isHide();return arguments.length==1?t?this.show():this.hide():e?this.show():this.hide()}get totalLength(){return this.el.getTotalLength()}scrollIntoView(){this.el.scrollIntoView()}addScrollLeft(t){return this.el.scrollLeft+=t,this}addScrollTop(t){return this.el.scrollTop+=t,this}setScrollTop(t){return this.el.scrollTop=t,this}setScrollLeft(t){return this.el.scrollLeft=t,this}scrollTop(){return this.el===document.body?d.getScrollTop():this.el.scrollTop}scrollLeft(){return this.el===document.body?d.getScrollLeft():this.el.scrollLeft}scrollHeight(){return this.el.scrollHeight}scrollWidth(){return this.el.scrollWidth}on(t,e,n,r){return this.el.addEventListener(t,e,n,r),this}off(t,e){return this.el.removeEventListener(t,e),this}getElement(){return this.el}createChild(t,e="",n={},r={}){let a=d.create(t,e,n);return a.css(r),this.append(a),a}get firstChild(){return d.create(this.el.firstElementChild)}get first(){return d.create(this.el.firstChild)}children(){var t=this.el.firstElementChild;if(!t)return[];var e=[];do e.push(d.create(t)),t=t.nextElementSibling;while(t);return e}hasChild(t){const e=t.el||t;return this.el===e?!1:this.el.contains(e)}get childNodes(){const t=[];if(this.el.hasChildNodes()){const e=this.el.childNodes;for(let n=0;n<e.length;n++)t.push(d.create(e[n]))}return t}childLength(){return this.el.children.length}replace(t){return this.el.parentNode&&this.el.parentNode.replaceChild(t.el||t,this.el),this}replaceChild(t,e){return this.el.replaceChild(e.el||e,t.el||t),this}checked(t=!1){return arguments.length==0?!!this.el.checked:(this.el.checked=!!t,this)}click(){return this.el.click(),this}focus(){return this.el.focus(),this}select(){if(this.attr("contenteditable")==="true"){var t=document.createRange();t.selectNodeContents(this.el);var e=window.getSelection();e.removeAllRanges(),e.addRange(t)}else this.el.select();return this}blur(){return this.el.blur(),this}context(t="2d"){return this._initContext||(this._initContext=this.el.getContext(t)),this._initContext}resize({width:t,height:e}){this._initContext=null;var n=this.context(),r=window.devicePixelRatio||1;this.px("width",+t),this.px("height",+e),this.el.width=t*r,this.el.height=e*r,n.scale(r,r)}toDataURL(t="image/png",e=1){return this.el.toDataURL(t,e)}clear(){this.context().clearRect(0,0,this.el.width,this.el.height)}update(t){this.clear(),t.call(this,this)}drawImage(t,e=0,n=0){var r=this.context(),a=window.devicePixelRatio||1;r.drawImage(t,e,n,t.width,t.height,0,0,this.el.width/a,this.el.height/a)}drawOption(t={}){var e=this.context();Object.assign(e,t)}drawLine(t,e,n,r){var a=this.context();a.beginPath(),a.moveTo(t,e),a.lineTo(n,r),a.stroke(),a.closePath()}drawPath(...t){var e=this.context();e.beginPath(),t.forEach((n,r)=>{r==0?e.moveTo(n[0],n[1]):e.lineTo(n[0],n[1])}),e.stroke(),e.fill(),e.closePath()}drawCircle(t,e,n){var r=this.context();r.beginPath(),r.arc(t,e,n,0,2*Math.PI),r.stroke(),r.fill()}drawText(t,e,n){this.context().fillText(n,t,e)}fullscreen(){var t=this.el;t.requestFullscreen?t.requestFullscreen():t.wekitRequestFullscreen&&t.wekitRequestFullscreen()}toggleFullscreen(){this.el===document.fullscreenElement?document.exitFullscreen():this.fullscreen()}}class ie{constructor(t){this.id=lt(),this.cachedCallback={},this.callbacks={},this.editor=t}getCallbacks(t){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t]}setCallbacks(t,e=[]){this.callbacks[t]=e}debug(...t){this.editor&&this.editor.context.config.get("debug.mode")&&console.debug(...t)}on(t,e,n,r=0,a=0,o=!1,l=!1,h=[],T=!1){var m=e;return r>0?m=g(e,r):a>0&&(m=w(e,a)),h.length&&(m=it(m,n,h)),T&&(m=Ft(m,n)),this.getCallbacks(t).push({event:t,callback:m,context:n,originalCallback:e,enableAllTrigger:o,enableSelfTrigger:l}),()=>{this.off(t,e)}}off(t,e){this.debug("off message event",t),arguments.length==1?this.setCallbacks(t):arguments.length==2&&this.setCallbacks(t,this.getCallbacks(t).filter(n=>n.originalCallback!==e))}offAll(t){Object.keys(this.callbacks).forEach(e=>{this.setCallbacks(e,this.getCallbacks(e).filter(n=>n.context!==t))}),this.debug("off all message",t.sourceName)}getCachedCallbacks(t){return this.getCallbacks(t)}sendMessage(t,e,...n){this.sendMessageList(t,[[e,...n]])}runMessage(t,e){const n=t.callback.apply(t.context,e);if(U(n)){if(n===!1)return;if(v(n)){n();return}}}sendMessageList(t,e=[]){window.Promise.resolve().then(()=>{e.forEach(([n,...r])=>{var a=this.getCachedCallbacks(n);if(a&&a.length){const o=a.filter(h=>!h.enableSelfTrigger).filter(h=>h.enableAllTrigger||h.originalCallback.source!==t);let l=o.length;for(;l--;){const h=o[l];this.runMessage(h,r)}}else this.debug(`message event ${n} is not exist.`)})})}nextSendMessage(t,e,...n){window.Promise.resolve().then(()=>{e(...n)})}triggerMessage(t,e,...n){window.Promise.resolve().then(()=>{var r=this.getCachedCallbacks(e);r?r.filter(o=>o.originalCallback.source===t).forEach(o=>{o.callback.apply(o.context,n)}):this.debug(e," is not valid event")})}emit(t,...e){v(t)?t(...e):$(t)?this.sendMessageList(this.source,t):this.sendMessage(this.source,t,...e)}nextTick(t){this.nextSendMessage(this.source,t)}trigger(t,...e){v(t)?t(...e):this.triggerMessage(this.source,t,...e)}}const At=/^@magic:([a-zA-Z][a-zA-Z0-9]*)[\W]{1}(.*)*$/g,Rt="@magic:",k="|",re=/(([\$a-z_\-]+)\([^\(\)]*\)|([a-z_\-]+))/gi,Nt="(",ae=")",ut={KEYWORD:"keyword",FUNCTION:"function",VALUE:"value"};class A{constructor(t){this.context=t.context,this.originalMethod=t.originalMethod,this.method=t.method,this.args=t.args,this.pipes=t.pipes,this.keys=t.keys,this.__cache=new Map}setCache(t,e){this.__cache.set(t,e)}hasCache(t){return this.__cache.has(t)}getCache(t){return this.__cache.get(t)}hasKeyword(t){if(this.hasCache(t))return this.getCache(t);let e=!1;return this.pipes.forEach(n=>{switch(n.type){case ut.KEYWORD:n.value===t&&(e=!0);break}}),this.setCache(t,e),e}hasFunction(t){if(this.hasCache(t))return this.getCache(t);let e=!!this.getFunction(t);return this.setCache(t,e),e}getFunction(t){return this.functions.find(e=>e.func===t)}getFunctionList(t){return this.functions.filter(e=>e.func===t)}get originalCallback(){return this.context[this.originalMethod]}get keywords(){return this.keys[ut.KEYWORD].map(t=>t.value)}get functions(){return this.keys[ut.FUNCTION]}get values(){return this.keys[ut.VALUE].map(t=>t.value)}execute(...t){return this.originalCallback.call(this.context,...t)}executeWithContext(t,...e){return this.originalCallback.call(t,...e)}static make(t,...e){return`${Rt}${t} ${e.join(k)}`}static check(t){return t.match(At)!==null}static parse(t,e={}){const n=t.match(At);if(!n)return;const r=n[0].split(Rt)[1].split(k).map(E=>E.trim());let[a,...o]=r;const[l,...h]=a.split(" "),T=o.map(E=>this.parsePipe(E)).filter(E=>E.value),m={function:[],keyword:[],value:[]};return T.forEach(E=>{E.type==="function"?m.function.push(E):E.type==="keyword"?m.keyword.push(E):m.value.push(E)}),new A({context:e,originalMethod:t,method:l,args:h,pipes:T,keys:m})}static parsePipe(t){const e=t.match(re);if(!e)return{type:"value",value:t};const[n]=e;if(n.includes(Nt)){const[r,a]=n.split(Nt),[o]=a.split(ae);return{type:"function",value:n,func:r,args:o.split(",").map(l=>l.trim()).filter(Boolean)}}return{type:"keyword",value:e[0]}}}const oe=(s,t=k)=>` ${t} ${s}`,Je="ME@",le=(...s)=>s.join(k),Ot=(...s)=>Je+le(...s),Qe=Ot,tn=Ot,ft=":",ce=" ",en={},c=(...s)=>{var t=s.join(ft);return(...e)=>{const[n,...r]=e;return A.make("domevent",[t,n].join(" "),...r)}},dt=(...s)=>A.make("subscribe",...s),nn=(...s)=>A.make("callback",...s),sn=(...s)=>A.make("observer",...s),u=(s,t=k)=>oe(s,t),yt=(s,t=k)=>u(`after(${s})`,t),rn=(s,t=k)=>u(`before(${s})`,t),an=u,on=u,ln=u("ArrowUp"),cn=u("ArrowDown"),hn=u("ArrowLeft"),un=u("ArrowRight"),fn=u("Enter"),dn=u("Space"),gn=u("Escape"),En=u("Backspace"),mn=u("Delete"),Tn=u("Equal"),Cn=u("Minus"),pn=u("BracketRight"),bn=u("BracketLeft"),vn=u("isAltKey"),An=u("isShiftKey"),Rn=u("isMetaKey"),Nn=u("isCtrlKey"),On=u("hasMouse"),yn=u("hasTouch"),Sn=u("hasPen"),wn=u("self"),he=u("isMouseLeftButton"),Ln=u("isMouseRightButton"),In=u("fit"),kn=u("passive"),Mn=u("domdiff"),ue=(s=100)=>u(`debounce(${s})`),_n=(s=300)=>u(`delay(${s})`),Pn=ue(1e3),Fn=(s=100)=>u(`throttle(${s})`),fe=u("allTrigger()"),de=u("selfTrigger()"),Dn=u("frame()"),Bn=s=>u(`params(${ht(s)})`),Un=u("capture()"),$n=yt("preventDefault"),Hn=yt("stopPropagation"),Gn=dt,Vn=(...s)=>dt(...s,fe),Kn=(...s)=>dt(...s,de),Wn=(s,...t)=>dt(`config:${s}`,...t),ge=nn,zn=ge("requestAnimationFrame"),Yn=sn,O=c,jn=c("click"),Xn=c("dblclick"),qn=c("mousedown"),xn=c("mouseup"),Zn=c("mousemove"),Jn=c("mouseover"),Qn=c("mouseout"),ts=c("mouseenter"),es=c("mouseleave"),ns=c("touchstart"),ss=c("touchmove"),is=c("touchend"),rs=c("keydown"),as=c("keyup"),os=c("keypress"),ls=c("drag"),cs=c("dragstart"),hs=c("drop"),us=c("dragover"),fs=c("dragenter"),ds=c("dragleave"),gs=c("dragexit"),Es=c("dragout"),ms=c("dragend"),Ts=c("contextmenu"),Cs=c("change"),ps=c("input"),bs=c("focus"),vs=c("focusin"),As=c("focusout"),Rs=c("blur"),Ns=c("paste"),Os=c("resize"),ys=c("scroll"),Ss=c("submit"),ws=(...s)=>O("pointerdown")(...s)+he,Ls=O("pointerover"),Is=O("pointerenter"),ks=O("pointerout"),Ms=O("pointermove"),_s=O("pointerup"),Ps=O("change","input"),Fs=O("wheel","mousewheel","DOMMouseScroll"),Ds=c("animationstart"),Bs=c("animationend"),Us=c("animationiteration"),$s=c("transitionstart"),Hs=c("transitionend"),Gs=c("transitionrun"),Vs=c("transitioncancel"),Ks=O("doubletab"),Ws=(s="$el")=>A.make("load",s),zs=s=>en[s]||"",Ee=s=>function(){return this.prevState[s]!=this.state[s]},me=()=>!0,Ys=(s="$el")=>A.make("bind",s);function js(s){let t=s.deltaX,e=s.deltaY;return t===0&&s.shiftKey&&([e,t]=[t,e]),s.deltaMode===window.WheelEvent.DOM_DELTA_LINE?e*=8:s.deltaMode===window.WheelEvent.DOM_DELTA_PAGE&&(e*=24),[Te(t,24),Te(e,24),0]}function Te(s,t){return Math.sign(s)*Math.min(t,Math.abs(s))}var St={addDomEvent(s,t,e,n=!1){s&&s.addEventListener(t,e,n)},removeDomEvent(s,t,e){s&&s.removeEventListener(t,e)},pos(s){return s.touches&&s.touches[0]?s.touches[0]:s},posXY(s){var t=this.pos(s);return{x:t.pageX,y:t.pageY}}};class q{constructor(t,e={}){this.context=t,this.options=e}initialize(){}load(){}refresh(){}render(){}getRef(t){return this.context.getRef(t)}run(){}destroy(){}}const Xs=(s,t)=>{if(bt(t))switch(s){case"width":case"height":case"top":case"left":case"right":case"bottom":return t+"px"}return t},qs=(s,t,e,n=!1)=>{if(t==="cssText"){s.cssText(e);return}else if(t==="style"){if(typeof e!="string"){const r={};if(Object.entries(e).forEach(([a,o])=>{r[a]=Xs(a,o)}),n){const a=Object.keys(r).map(o=>`${o}:${r[o]};`).join("");s.attr("style",a)}else s.css(r)}return}else if(t==="class"){Array.isArray(e)?s.updateClass(Y(...e)):s.updateClass(Y(e));return}else if(t==="callback"&&typeof e=="function"){e();return}typeof e=="undefined"?s.removeAttr(t):s.el.nodeName==="TEXTAREA"&&t==="value"||t==="text"||t==="textContent"?s.text(e):t==="innerHTML"||t==="html"?s.html(e):t==="htmlDiff"?s.updateDiff(e):t==="svgDiff"?s.updateSVGDiff(e):t==="value"?s.val(e):s.attr(t,e)},wt={};class xs extends q{async initialize(){wt[this.context.sourceName]||(wt[this.context.sourceName]=this.context.filterMethodes("bind"))}getBindMethods(){return wt[this.context.sourceName]||[]}async bindData(...t){const e=this.getBindMethods();if(!(e!=null&&e.length))return;const n=e==null?void 0:e.filter(r=>t.length?t.indexOf(r.args[0])>-1:!0);await Promise.all(n==null?void 0:n.map(async r=>{let a=this.getRef(`${r.keywords[0]}`),o=me;typeof a=="string"&&a!==""?o=Ee(a):typeof a=="function"&&(o=a);const l=r.args[0];let h=this.context.refs[l];const T=typeof o=="function"&&o.call(this.context);if(h&&T){const R=await r.executeWithContext(this.context,...t);if(!R)return;const N=Object.keys(R);for(var m=0,E=N.length;m<E;m++){const B=N[m],W=R[B];qs(h,B,W,this.context.isServer)}}}))}destroy(){this._bindMethods=void 0}}class Zs extends q{initialize(){var t,e;this.destroy(),this._callbacks||(this._callbacks=this.context.filterMethodes("callback")),!((t=this._bindings)!=null&&t.length)&&((e=this._callbacks)==null?void 0:e.length)&&this._callbacks.forEach(n=>this.parseCallback(n))}destroy(){this.context.notEventRedefine||this.removeCallbackAll()}getCallback(t){return this.context[t]}removeCallbackAll(){this.getBindings().forEach(t=>{this.removeCallback(t)}),this.initBindings()}removeCallback({requestId:t}){window.cancelAnimationFrame(t)}getBindings(){return this._bindings||this.initBindings(),this._bindings}addBinding(t){this.getBindings().push(t)}initBindings(){this._bindings=[]}makeCallback(t){const e=t.callback,n=r=>{e(r),t.requestId=window.requestAnimationFrame(n)};return()=>{t.requestId=window.requestAnimationFrame(n)}}addCallback(t,e){const n=this.makeCallback(t,e);this.addBinding(t),n()}bindingCallback(t,e){var h,T;const n={eventName:t.args[0],callback:e};n.codes=[],n.checkMethodList=[];const r=t.getFunction("debounce"),a=t.getFunction("throttle");if(r){var o=+(((h=r.args)==null?void 0:h[0])||0);n.callback=g(e,o)}else if(a){var l=+(((T=a.args)==null?void 0:T[0])||0);n.callback=w(e,l)}t.keywords.forEach(m=>{const E=m;this.getCallback(E)?n.checkMethodList.push(E):n.codes.push(E.toLowerCase())}),this.addCallback(n,t)}parseCallback(t){const e=this.context;var n=t.args;if(n){var r=e[t.originalMethod].bind(e);this.bindingCallback(t,r)}}}const Js={touchstart:!0,touchmove:!0,mousedown:!0,mouseup:!0,mousemove:!0},Qs={doubletab:"touchend"},ti={doubletab:!0},ei={self(s){return s&&s.$dt&&s.$dt.is(s.target)},isAltKey(s){return s.altKey},isCtrlKey(s){return s.ctrlKey},isShiftKey(s){return s.shiftKey},isMetaKey(s){return s.metaKey||s.key=="Meta"||s.code.indexOf("Meta")>-1},isMouseLeftButton(s){return s.buttons===1},isMouseRightButton(s){return s.buttons===2},hasMouse(s){return s.pointerType==="mouse"},hasTouch(s){return s.pointerType==="touch"},hasPen(s){return s.pointerType==="pen"},preventDefault(s){return s.preventDefault(),!0},stopPropagation(s){return s.stopPropagation(),!0}};class ni extends q{initialize(){var t,e;this.destroy(),!(this._domEvents&&this.context.notEventRedefine)&&((!this._domEvents||this._domEvents.length===0||this._bindings.length===0)&&(this._domEvents=this.context.filterMethodes("domevent")),!((t=this._bindings)!=null&&t.length)&&((e=this._domEvents)==null?void 0:e.length)&&this._domEvents.forEach(n=>this.parseDomEvent(n)))}destroy(){this.context.notEventRedefine||this.removeEventAll()}getCallback(t){return this.context[t]||ei[t]}removeEventAll(){this.getBindings().forEach(t=>{this.removeDomEvent(t)}),this.initBindings()}removeDomEvent({eventName:t,dom:e,callback:n}){St.removeDomEvent(e,t,n)}getBindings(){return this._bindings||this.initBindings(),this._bindings}addBinding(t){this.getBindings().push(t)}initBindings(){this._bindings=[]}matchPath(t,e){return t?t.matches(e)?t:this.matchPath(t.parentElement,e):null}hasDelegate(t,e){return this.matchPath(t.target||t.srcElement,e.delegate)}makeCallback(t,e,n){return t.delegate?this.makeDelegateCallback(t,e,n):this.makeDefaultCallback(t,e,n)}makeDefaultCallback(t,e,n){return r=>{var a=this.runEventCallback(r,t,e,n);if(U(a))return a}}makeDelegateCallback(t,e,n){return r=>{const a=this.hasDelegate(r,t);if(a){r.$dt=d.create(a);var o=this.runEventCallback(r,t,e,n);if(U(o))return o}}}runEventCallback(t,e,n,r){const a=this.context;if(t.xy=St.posXY(t),e.beforeMethods.length&&e.beforeMethods.every(l=>this.getCallback(l.target).call(a,t,l.param)),this.checkEventType(t,e)){var o=r(t,t.$dt,t.xy);return o!==!1&&e.afterMethods.length&&e.afterMethods.forEach(l=>this.getCallback(l.target).call(a,t,l.param)),o}}checkEventType(t,e){const n=this.context;var r=!0;e.codes.length&&(r=(t.code?e.codes.indexOf(t.code.toLowerCase())>-1:!1)||(t.key?e.codes.indexOf(t.key.toLowerCase())>-1:!1));var a=!0;return e.checkMethodList.length&&(a=e.checkMethodList.every(o=>{var l=this.getCallback(o);return v(l)&&l?l.call(n,t):U(l)?!!l:!0})),r&&a}getDefaultDomElement(t){const e=this.context;let n;return t?n=e.refs[t]||e[t]||window[t]:n=e.el||e.$el||e.$root,n instanceof d?n.getElement():n}getRealEventName(t){return Qs[t]||t}getCustomEventName(t){return ti[t]?t:""}getDefaultEventObject(t,e,n,r,a){var B,W;const o={eventName:this.getRealEventName(t),customEventName:this.getCustomEventName(t),callback:a},[,,...l]=r.args;o.dom=this.getDefaultDomElement(e),o.delegate=l.join(ce),o.beforeMethods=[],o.afterMethods=[],o.codes=[],o.checkMethodList=[];const h=r.getFunction("debounce"),T=r.getFunction("throttle");if(h){var m=+(((B=h.args)==null?void 0:B[0])||0);o.callback=g(a,m)}else if(T){var E=+(((W=T.args)==null?void 0:W[0])||0);o.callback=w(a,E)}const R=r.getFunctionList("after"),N=r.getFunctionList("before");return R.length&&R.forEach(_=>{var S=_.args[0].split(" "),[P,L]=S;o.afterMethods.push({target:P,param:L})}),N.length&&N.forEach(_=>{var S=_.args[0].split(" "),[P,L]=S;o.beforeMethods.push({target:P,param:L})}),r.keywords.forEach(_=>{const S=_;this.getCallback(S)?o.checkMethodList.push(S):o.codes.push(S.toLowerCase())}),o}addDomEvent(t,e,n){t.callback=this.makeCallback(t,e,n),this.addBinding(t);var r=!1;e.hasKeyword("capture")&&(r=!0),Js[t.eventName]&&(r={passive:!0,capture:r}),t.dom&&St.addDomEvent(t.dom,t.eventName,t.callback,r)}makeCustomEventCallback(t,e,n){var o;if(t.customEventName==="doubletab"){var r=300,a=e.getFunction("delay");return a&&(r=+(((o=a.args)==null?void 0:o[0])||0)),(...l)=>{this.doubleTab?(window.performance.now()-this.doubleTab.time<r&&n(...l),this.doubleTab=null):this.doubleTab={time:window.performance.now()}}}return n}bindingDomEvent([t,e,...n],r,a){let o=this.getDefaultEventObject(t,e,n,r,a);o.callback=this.makeCustomEventCallback(o,r,o.callback),this.addDomEvent(o,r,o.callback)}getEventNames(t){let e=[];return t.split(ft).forEach(n=>{var r=n.split(ft);e.push.apply(e,r)}),e}parseDomEvent(t){const e=this.context;var n=t.args;if(n){var r=this.getEventNames(n[0]),a=e[t.originalMethod].bind(e);for(let o=0,l=r.length;o<l;o++)n[0]=r[o],this.bindingDomEvent(n,t,a)}}}class si extends q{initialize(){var t,e;this.destroy(),!(this._observers&&this.context.notEventRedefine)&&((!this._observers||this._observers.length===0)&&(this._observers=this.context.filterMethodes("observer")),!((t=this._bindings)!=null&&t.length)&&((e=this._observers)==null?void 0:e.length)&&this._observers.forEach(n=>this.parseObserver(n)))}destroy(){this.context.notEventRedefine||this.removeEventAll()}removeEventAll(){this.getBindings().forEach(t=>{this.removeDomEvent(t)}),this.initBindings()}disconnectObserver(t){t==null||t.disconnect()}getBindings(){return this._bindings||this.initBindings(),this._bindings}addBinding(t){this.getBindings().push(t)}initBindings(){this._bindings=[]}addObserver(t){this.addBinding(t)}getDefaultDomElement(t){const e=this.context;let n;return t?n=e.refs[t]||e[t]||window[t]:n=e.el||e.$el||e.$root,n instanceof d?n.getElement():n}createObserver(t,e){var T;const[n,r]=t.args||["intersection"],a=this.getDefaultDomElement(r),o=t.getFunction("params"),l=X((T=o==null?void 0:o.args)==null?void 0:T[0]);let h;switch(n){case"intersection":l.root&&(l.root=this.getDefaultDomElement(l.root)),h=new window.IntersectionObserver(e,l||{}),h.observe(a);break;case"mutation":h=new window.MutationObserver(e),h.observe(a,l||{attributes:!0,characterData:!0,childList:!0});break;case"performance":h=new window.PerformanceObserver(e),h.observe(l||{entryTypes:["paint"]});break}return h}bindingObserver(t,e){this.addObserver(this.createObserver(t,e))}parseObserver(t){const e=this.context;var n=e[t.originalMethod].bind(e);this.bindingObserver(t,n)}}class ii extends q{initialize(){var t,e;this.destroy(),this._callbacks||(this._callbacks=this.context.filterMethodes("subscribe")),!((t=this._bindings)!=null&&t.length)&&((e=this._callbacks)==null?void 0:e.length)&&this._callbacks.forEach(n=>this.parseSubscribe(n))}destroy(){this.context.notEventRedefine||this.context.$store.offAll(this.context)}getCallback(t){return this.context[t]}getBindings(){return this._bindings||this.initBindings(),this._bindings}addBinding(t){this.getBindings().push(t)}initBindings(){this._bindings=[]}createLocalCallback(t,e){var n=e.bind(this.context);return n.displayName=`${this.context.sourceName}.${t}`,n.source=this.context.source,n}parseSubscribe(t){var _,S;const e=t.args.join(" "),n=[],r=[];let a=0,o=0,l=!1,h=!1,T=!1;const m=t.getFunction("debounce"),E=t.getFunction("throttle"),R=t.getFunction("allTrigger"),N=t.getFunction("selfTrigger"),B=t.getFunction("frame");m&&(a=+(((_=m.args)==null?void 0:_[0])||0)),E&&(o=+(((S=E.args)==null?void 0:S[0])||0)),R&&(l=!0),N&&(h=!0),B&&(T=!0),t.keywords.forEach(P=>{const L=P;this.context[L]?n.push(L):r.push(L)});const W=this.context[t.originalMethod];[...r,e].filter(Boolean).forEach(P=>{var L=this.createLocalCallback(P,W);this.context.$store.on(P,L,this.context,a,o,l,h,n,T)}),this.addBinding(t)}}ne({BindHandler:xs,CallbackHandler:Zs,DomEventHandler:ni,ObserverHandler:si,StoreHandler:ii});const x="ref",Ce=d.create("div"),pe=`[${x}]`,Lt="refclass",ri=`[${Lt}]`,be=[],kt=class{constructor(t,e){b(this,mt);b(this,nt);b(this,Tt);b(this,y,{});b(this,Et,{});b(this,J,0);b(this,G,void 0);b(this,Q,void 0);b(this,V,void 0);b(this,K,{});b(this,M,{});b(this,tt,!1);b(this,et,[]);this.refs={},this.children={},this.id=vt(),this.initializeProperty(t,e),this.handlers=this.initializeHandler(),this.initComponents()}get __timestamp(){return C(this,J)}get timestamp(){return C(this,Q)}set timestamp(t){p(this,Q,t)}get target(){return this.$el.el}checkProps(t={}){return t}initializeProperty(t,e={}){this.opt=t||{},this.parent=this.opt,this.source=vt(),this.sourceName=this.constructor.name,this.props=new Proxy(C(this,K),{get:(n,r)=>st(this,Tt,Le).call(this,r),set:(n,r)=>{throw new Error(`${r} is readonly`)}}),st(this,nt,Pt).call(this,e)}hasProp(t){return C(this,et).includes(t==null?void 0:t.toUpperCase())}setServer(t=!0){p(this,tt,t)}get isServer(){var t;return((t=this.parent)==null?void 0:t.isServer)||C(this,tt)}initComponents(){this.childComponents=this.components()}initializeHandler(){return se(this)}initState(){return{}}setState(t={},e=!0){p(this,Et,C(this,y)),p(this,y,Object.assign({},C(this,y),t)),e&&this.load()}toggleState(t,e=!0){this.setState({[t]:!C(this,y)[t]},e)}apply(t){return qt(t)}_reload(t,e=null){e&&this.render(e),st(this,nt,Pt).call(this,t),p(this,y,{}),this.setState(this.initState(),!1),this.refresh(!0)}checkLoad(t){window.requestAnimationFrame(()=>{this.render(t)})}get state(){return C(this,y)}get propKeys(){return C(this,M)}get ref(){return this.props.ref}get isPreLoaded(){return!0}async render(t){if(!this.isPreLoaded){this.checkLoad(t);return}const e=this.template(),n=this.parseTemplate(e);return this.$el?this.$el.htmlDiff(n):(this.$el=n,this.refs.$el=this.$el,t&&t.hasChild(this.$el)===!1&&t.append(this.$el)),await this.load(),this.afterRender(),this}get html(){return this.$el.outerHTML()}initialize(){p(this,y,this.initState())}afterRender(){}components(){return Mt({},this.parent.childComponents)}getRef(...t){const e=t.join("");return this.refs[e]}refreshElementReference(t,e){for(var n=t.$$(pe),r=0,a=n.length;r<a;r++){const o=n[r],l=o.attr(x);this.refs[l]?this.refs[l].is(o)===!1&&(this.refs[l]=o):this.refs[l]=o}this.afterLoadRendering(t,e)}afterLoadRendering(){}afterComponentRendering(){}parseTemplate(t,e){let n=d.makeElementList(t);for(var r=0,a=n.length;r<a;r++){const E=n[r];var o=E.attr(x);o&&(e||(this.refs[o]=E));for(var l=E.$$(pe),h={},T=0,m=l.length;T<m;T++){const R=l[T],N=R.attr(x);h[N]?console.warn(`${o} is duplicated. - ${this.sourceName}`,this):h[N]=!0,e||(this.refs[N]=R)}}return e?(Ce.append(n),Ce.createChildrenFragment()):n[0]}parsePropertyInfo(t){let e={};for(var n of t.attributes){const a=n.name||n.nodeName,o=n.value||n.nodeValue;if(Xt(a)){const l=X(a);z(l)?e=Object.assign(e,l):e[a]=X(o)}else e[a]=X(o)}const r=t.html();return r&&(e.content=r,e.contentChildren=this.parseContent(e.content)),e}parseSourceName(t){return t.parent?[t.sourceName,...this.parseSourceName(t.parent)]:[t.sourceName]}getEventMachineComponent(t){var e=Qt(t)||this.childComponents[t];return e}createFunctionComponent(t,e,n=kt){class r extends n{template(){return t.call(this,this.props)}}return new r(this,e)}createInstanceForComponent(t,e,n){return t.__proto__.name==="ProxyComponent"?new t({target:e,props:n}):t.__proto__.name===""&&v(t)?this.createFunctionComponent(t,n):new t(this,n)}async renderComponent({$dom:t,refName:e,component:n,props:r}){var o;var a=null;this.children[e]?(a=this.children[e],a.timestamp=this.__timestamp,a._reload(r)):(a=this.createInstanceForComponent(n,t.$parent.el,r),a.timestamp=this.__timestamp,this.children[e||a.id]=a,v(a.render)&&await a.render()),this.afterComponentRendering(t,e,a,r),a.renderTarget?((o=a.$el)==null||o.appendTo(a.renderTarget),t.remove()):a.$el?t.replace(a.$el):t.remove()}parseContent(t,e=[]){return d.create("div").html(t).children().map(n=>this._getComponentInfo(n)).filter(n=>e.length===0?!0:e.includes(n.refClass))}_getComponentInfo(t){const e=t.attr(Lt),n=this.getEventMachineComponent(e);if(n){let r=this.parsePropertyInfo(t),a=t.attr(x);return{$dom:t,refClass:e,props:r,refName:a||r.ref,component:n}}else return{refClass:e,notUsed:!0,$dom:t}}getComponentInfoList(t){if(!t)return be;let e=t.$$(ri).filter(n=>n.path().filter(r=>r.attr(Lt)).length===1);return e.length?e.map(n=>this._getComponentInfo(n)):be}async parseComponent(){const t=this.$el,e=this.getComponentInfoList(t);!e.length||(await Promise.all(e.map(async n=>{n.notUsed?(n.$dom.remove(),console.warn(`${n.refClass} is not used.`)):await this.renderComponent(n)})),pt(this.children,(n,r)=>{r.timestamp!==this.__timestamp&&r.clean()}))}clean(){if(this.$el&&!this.$el.hasParent())return pt(this.children,(t,e)=>{v(e==null?void 0:e.clean)&&e.clean()}),this.destroy(),!0}refresh(){this.load()}async _afterLoad(){st(this,mt,we).call(this),this.runHandlers("initialize"),await this.bindData(),await this.parseComponent()}async makeLoadAction(t){const[e,...n]=t.args;let r=t.hasKeyword("domdiff");const a=this.refs[e];if(a){const o=await t.execute(...n),l=this.parseTemplate(o,!0);r?a.htmlDiff(l):a.html(l),this.refreshElementReference(a,e)}}async load(...t){C(this,G)||p(this,G,this.filterMethodes("load"));const e=C(this,G).filter(n=>t.length===0?!0:n.args[0]===t[0]);await Promise.all(e.map(async n=>{await this.makeLoadAction(n)})),await this._afterLoad()}async runHandlers(t="run",...e){await Promise.all(this.handlers.filter(n=>n[t]).map(async n=>{await n[t](...e)}))}async bindData(...t){await this.runHandlers("bindData",...t)}template(){return null}eachChildren(t){!v(t)||Object.keys(this.children).forEach(e=>{t(this.children[e])})}hmr(){this.created(),this.initialize(),this.rerender(),this.eachChildren(t=>{t.hmr()})}rerender(){var t=this.$el.parent();this.destroy(),this.render(t)}destroy(){this.eachChildren(t=>{t.destroy()}),this.runHandlers("destroy"),this.$el&&this.$el.remove(),this.$el=null,this.refs={},this.children={}}collectMethodes(t=!1){return(!C(this,V)||t)&&p(this,V,f(this,e=>A.check(e)).map(e=>A.parse(e,this))),C(this,V)}filterMethodes(t,e=!1){return this.collectMethodes(e).filter(n=>n.method===t)}findChildren(t){return this.props.contentChildren.filter(e=>e.component===t)}findChildByRef(t){const e=[];return Object.keys(this.children).forEach(n=>{const r=this.children[n];r.ref===t&&e.push(r),Object.keys(r.children).length&&e.push(...r.findChildByRef(t))}),e}findRef(t){const e=[];return Object.keys(this.children).forEach(n=>{const r=this.children[n];if(t(r)&&e.push(r),e.length||(r.children&&e.push(...r.findNestedChildren(t)),e.length))return e}),e}getChildContent(t,e=""){var n;return((n=this.getChild(t))==null?void 0:n.props.content)||e}getChild(t){return this.props.contentChildren.find(t)}};let It=kt;y=new WeakMap,Et=new WeakMap,J=new WeakMap,G=new WeakMap,Q=new WeakMap,V=new WeakMap,K=new WeakMap,M=new WeakMap,tt=new WeakMap,et=new WeakMap,mt=new WeakSet,we=function(){Se(this,J)._++},nt=new WeakSet,Pt=function(t){p(this,K,this.checkProps(t)),p(this,M,{}),Object.keys(t).forEach(e=>{C(this,M)[e.toUpperCase()]=e}),p(this,et,Object.keys(C(this,M)))},Tt=new WeakSet,Le=function(t){return C(this,K)[C(this,M)[t.toUpperCase()]]};const Ct=class extends It{constructor(e,n={}){super(e,n);b(this,D,void 0);n.store?p(this,D,n.store):p(this,D,new ie),this.created(),this.initialize()}currentContext(){return this.contexts[this.contexts.length-1]}setStore(e){p(this,D,e)}get $store(){return C(this,D)||this.parent.$store}async created(){}createLocalCallback(e,n){var r=n.bind(this);return r.displayName=`${this.sourceName}.${e}`,r.source=this.source,r}emit(e,...n){this.$store.source=this.source,this.$store.sourceContext=this,this.$store.emit(e,...n)}nextTick(e,n=0){window.setTimeout(()=>{this.$store.nextTick(e)},n)}trigger(e,...n){this.$store.source=this.source,this.$store.trigger(e,...n)}broadcast(e,...n){Object.keys(this.children).forEach(r=>{this.children[r].trigger(e,...n),this.children[r].broadcast(e,...n)})}on(e,n,r=0,a=0,o=!1,l=!1,h=!1){this.$store.on(e,n,this.source,r,a,o,l,[],h)}off(e,n){this.$store.off(e,n,this.source)}subscribe(e,n=0,r=0){const a=`subscribe.${lt()}`,o=this.createLocalCallback(a,e);return this.$store.on(a,o,this,n,r,!1,!0),a}createFunctionComponent(e,n,r=Ct){return super.createFunctionComponent(e,n,r)}static createElementInstance(e,n){if(e.__proto__.name===""){class r extends Ct{template(){return e.call(this,this.props)}}return new r(n,n)}else return new e(n,n)}};let Z=Ct;D=new WeakMap;const ai=(s,t={})=>{const e=d.create(t.container||document.body),n=Z.createElementInstance(s,t);return n.render(e),te(n),n};async function oi(s,t){const e=Z.createElementInstance(s,t);return e.setServer(!0),(await e.render()).html}function li(s,t=""){var e=s||{};return Object.keys(e).filter(n=>U(e[n])).map(n=>`${n}: ${e[n]}`).join(";"+t)}function ci(s){return Object.keys(s||{}).map(e=>e==="class"&&z(s[e])?`${e}="${Y(s[e])}"`:e==="style"&&z(s[e])?`${e}="${li(s[e])}"`:Ut(s[e])||rt(s[e])||s[e]==="undefined"?s[e]?e:"":`${e}="${s[e]}"`).join(" ")}function gt(s,t={},e=[]){e=e.flat(1/0).join("");let n;n=Object.keys(t).length?ht(t):"";const r=t.ref?`ref="${t.ref}"`:"";return`<object refClass="${s}" ${r} ${n}>${e}</object>`}function ve(...s){return s.map(t=>{let e,n={},r=[];return F(t)?e=t:$(t)&&([e,n={},r=[]]=t),r.length?gt(e,n,ve(r)):gt(e,n)}).join(`
`)}function Ae(s,t,e=[]){return e=e.flat(1/0),`<${s} ${ci(t)}>${e.join(" ")}</${s}>`}function hi(s,t={},...e){if(e=e.flat(1/0),s===Re)return e;if(t=t||{},typeof s!="string"){const n=s.name;return xt({[n]:s}),gt(n,t,e)}else return Ae(s,t,e)}const Re=new Object;i.AFTER=yt,i.ALL_TRIGGER=fe,i.ALT=vn,i.ANIMATIONEND=Bs,i.ANIMATIONITERATION=Us,i.ANIMATIONSTART=Ds,i.ARROW_DOWN=cn,i.ARROW_LEFT=hn,i.ARROW_RIGHT=un,i.ARROW_UP=ln,i.BACKSPACE=En,i.BEFORE=rn,i.BIND=Ys,i.BIND_CHECK_DEFAULT_FUNCTION=me,i.BIND_CHECK_FUNCTION=Ee,i.BLUR=Rs,i.BRACKET_LEFT=bn,i.BRACKET_RIGHT=pn,i.BaseStore=ie,i.CALLBACK=ge,i.CAPTURE=Un,i.CHANGE=Cs,i.CHANGEINPUT=Ps,i.CHECKER=u,i.CLICK=jn,i.COMMAND=Qe,i.CONFIG=Wn,i.CONTEXTMENU=Ts,i.CONTROL=Nn,i.CUSTOM=O,i.D1000=Pn,i.DEBOUNCE=ue,i.DELAY=_n,i.DELETE=mn,i.DOMDIFF=Mn,i.DOUBLECLICK=Xn,i.DOUBLETAB=Ks,i.DRAG=ls,i.DRAGEND=ms,i.DRAGENTER=fs,i.DRAGEXIT=gs,i.DRAGLEAVE=ds,i.DRAGOUT=Es,i.DRAGOVER=us,i.DRAGSTART=cs,i.DROP=hs,i.Dom=d,i.DomDiff=ot,i.ENTER=fn,i.EQUAL=Tn,i.ESCAPE=gn,i.EVENT=Ot,i.FIT=In,i.FOCUS=bs,i.FOCUSIN=vs,i.FOCUSOUT=As,i.FRAME=Dn,i.FUNC_END_CHARACTER=ae,i.FUNC_REGEXP=re,i.FUNC_START_CHARACTER=Nt,i.FragmentInstance=Re,i.IF=an,i.INPUT=ps,i.KEY=on,i.KEYDOWN=rs,i.KEYPRESS=os,i.KEYUP=as,i.LEFT_BUTTON=he,i.LOAD=Ws,i.MAGIC_METHOD=Rt,i.MAGIC_METHOD_REG=At,i.META=Rn,i.MINUS=Cn,i.MOUSE=On,i.MOUSEDOWN=qn,i.MOUSEENTER=ts,i.MOUSELEAVE=es,i.MOUSEMOVE=Zn,i.MOUSEOUT=Qn,i.MOUSEOVER=Jn,i.MOUSEUP=xn,i.MagicMethod=A,i.NAME_SAPARATOR=ft,i.OBSERVER=Yn,i.ON=tn,i.PARAMS=Bn,i.PASSIVE=kn,i.PASTE=Ns,i.PEN=Sn,i.PIPE=le,i.POINTEREND=_s,i.POINTERENTER=Is,i.POINTERMOVE=Ms,i.POINTEROUT=ks,i.POINTEROVER=Ls,i.POINTERSTART=ws,i.PREVENT=$n,i.RAF=zn,i.RESIZE=Os,i.RIGHT_BUTTON=Ln,i.SAPARATOR=ce,i.SCROLL=ys,i.SELF=wn,i.SELF_TRIGGER=de,i.SHIFT=An,i.SPACE=dn,i.SPLITTER=k,i.STOP=Hn,i.SUBMIT=Ss,i.SUBSCRIBE=Gn,i.SUBSCRIBE_ALL=Vn,i.SUBSCRIBE_SELF=Kn,i.THROTTLE=Fn,i.TOUCH=yn,i.TOUCHEND=is,i.TOUCHMOVE=ss,i.TOUCHSTART=ns,i.TRANSITIONCANCEL=Vs,i.TRANSITIONEND=Hs,i.TRANSITIONRUN=Gs,i.TRANSITIONSTART=$s,i.UIElement=Z,i.VARIABLE_SAPARATOR=Yt,i.WHEEL=Fs,i.classnames=Y,i.clone=Fe,i.collectProps=f,i.combineKeyArray=De,i.createComponent=gt,i.createComponentList=ve,i.createElement=Ae,i.createElementJsx=hi,i.createHandlerInstance=se,i.debounce=g,i.defaultValue=Bt,i.get=ke,i.getRef=zs,i.getRootElementInstanceList=ee,i.getVariable=X,i.hasVariable=Xt,i.ifCheck=it,i.initializeGroupVariables=Xe,i.isArray=$,i.isBoolean=Ut,i.isFunction=v,i.isNotString=Me,i.isNotUndefined=U,i.isNotZero=_e,i.isNumber=bt,i.isObject=z,i.isString=F,i.isUndefined=rt,i.isZero=$t,i.keyEach=pt,i.keyMap=Dt,i.keyMapJoin=Ie,i.makeEventChecker=oe,i.makeRequestAnimationFrame=Ft,i.normalizeWheelEvent=js,i.recoverVariable=jt,i.registAlias=qe,i.registElement=xt,i.registHandler=ne,i.registRootElementInstance=te,i.renderRootElementInstance=xe,i.renderToString=oi,i.replaceElement=Zt,i.retriveAlias=Jt,i.retriveElement=Qt,i.retriveHandler=Ze,i.spreadVariable=qt,i.start=ai,i.throttle=w,i.uuid=vt,i.uuidShort=lt,i.variable=ht,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
